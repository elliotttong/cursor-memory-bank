import{a as k,b as F}from"./chunk-AWMOQZPV.js";import{a as w}from"./chunk-LXDXREIX.js";import{a as D}from"./chunk-VYK2SFTV.js";import{Ca as P,La as M,Oa as N,bb as G,db as y,gb as O,ha as A,qb as R}from"./chunk-6VFX2JNU.js";import{k as W,p as b,v as q}from"./chunk-LUKOAFYK.js";import"./chunk-O77QQVYU.js";import"./chunk-35EEQS33.js";import"./chunk-BGIN6QNH.js";import"./chunk-UQBFOPQH.js";import"./chunk-6HLOLWYC.js";import"./chunk-D2ACMGPV.js";import{k as S}from"./chunk-NORECDYR.js";import{g as L}from"./chunk-RQERJHUS.js";import{d as C,h as f,j as preactH,o as p}from"./chunk-NUN3A7RC.js";p();f();var T=C(L()),$=C(W());p();f();var u=C(L());var X=S(y)`
  font-family: var(--font-family);
  margin-left: 8px;
  background: rgba(32, 33, 36, 0.059);
  border-radius: 4px;
  cursor: pointer;
  height: 20px;
  padding: 3px 4px;
  overflow: hidden;
`,U=S(y)`
  font-size: 12px;
  font-weight: 500;
  line-height: 16px;
`,_=(e,n,r="")=>{if(e instanceof HTMLElement&&(n.some(t=>e.classList.contains(t))||r.split(", ").some(t=>e.matches(t))||e.clientWidth===1||e.style.display==="none"||e.style.visibility==="hidden"))return[];let o=Array.from(e.childNodes);return o.length===0?e.nodeType===Node.TEXT_NODE?[{text:e.textContent??"",elem:e}]:[]:o.flatMap(t=>t.nodeType===Node.TEXT_NODE?[{text:t.textContent??"",elem:t}]:t.nodeType===Node.ELEMENT_NODE?_(t,n,r):[]).filter(t=>t.text.trim().replace(/\n|\r\n/,"").length>1).filter(t=>(t.text.match(/\w+/)?.length??0)>0)},Y=async(e,n,r="")=>{let{ObjectRef:o}=await A();return{getContent:await G(async()=>({content:_(e,n,r).map(t=>t.elem),chunksAfter:0,chunksBefore:0})),converter:s=>({text:D(s),ref:new o({ref:s})}),options:{autoplay:!0,sideEffects:!1},metadata:{source:"Google"}}},j=({isPlaying:e,isLoading:n,...r})=>{let o=(0,u.useMemo)(()=>n?"loading":e?"playing":"paused",[e,n]);return preactH(y,{...r},o==="playing"&&preactH(k,null),o==="loading"&&preactH(w,{color:"#4A4A4A",width:"14",height:"14"}),o==="paused"&&preactH(F,null))},h=({ignoreClasses:e,ignoreTags:n,handle:r,onStateChange:o,wrapper:s})=>{let[t,i]=(0,u.useState)(null),{play:a,pause:l,isActive:c,state:m,queueAndPlayContent:I}=N(t)??{},{duration:x}=M(t,c),E=c&&m==="playing",v=c&&m==="buffering";(0,u.useEffect)(()=>{Y(s,e,n).then(i)},[s]),(0,u.useEffect)(()=>{o(r,m,l)},[m]);let Q=async d=>{if(d.preventDefault(),d.stopPropagation(),b()||q("browser-action",{animate:!1},"pill-player"),!c)return I();if(!v){if(E)return l();if(!E)return a()}};return preactH(X,{yAlign:!0,relative:!0,column:!1,onClick:d=>Q(d),separation:"4px"},!x.isLoading&&preactH(j,{isLoading:v,isPlaying:E}),preactH(U,{yAlign:!0,xAlign:!0},preactH(R,{color:"#676767",fixedWidthNumbers:!0,duration:x})))};var g="speechify-google-play-button-container";async function B(e,n,r=250){return new Promise(o=>{setTimeout(()=>{(0,T.render)(e,n),o(!0)},r)})}async function z(e,n,r,o){let s=Array.from(document.querySelectorAll(e.selector)).filter(Boolean);for(let[t,i]of s.entries())if(i){if(i.querySelector(`.${g}`))continue;let a=i.querySelector(e.player);if(!a)continue;let l=document.createElement("div");l.className=g,l.setAttribute("style",e.css),B(preactH(h,{ignoreClasses:n,ignoreTags:r,handle:`google-faq-${t}`,key:`google-faq-${t}}`,onStateChange:o,wrapper:i}),l),a.prepend(l)}}async function H(e,n,r,o){let s=document.querySelector(e.selector);if(!s||s.querySelector(`.${g}`))return;let t=s.querySelector(e.player);if(!t)return;let i=document.createElement("div");i.className=g,i.setAttribute("style",e.css),i.setAttribute("data-testId",O.GOOGLE_ABOUT_PLAY_BUTTON),B(preactH(h,{ignoreClasses:n,ignoreTags:r,handle:"google-panel",key:"google-panel",onStateChange:o,wrapper:s}),i),t.prepend(i)}async function J(e,n,r,o){let s=Array.from(document.querySelectorAll(e.selector)).filter(Boolean);for(let[t,i]of s.entries()){let a=i.parentElement?.parentElement;if(a){if(a.querySelector(`.${g}`))continue;let l=a.querySelector(e.player);if(!l)continue;let c=document.createElement("div");c.className=g,c.setAttribute("style",e.css),(0,T.render)(preactH(h,{ignoreClasses:n,ignoreTags:r,handle:`google-site-${t}`,key:`google-site-${t}`,onStateChange:o,wrapper:a}),c),l.append(c)}}}var K=e=>e.some(n=>n.target instanceof HTMLElement?n.target?.className?.includes("speechify")||n.target?.id?.includes("speechify"):!1);async function V(e){await P(e.selectors.mutationContainer);let n=()=>{},r=(0,$.debounce)(t=>{if(K(t))return;let{ignoreClasses:i,ignoreTags:a}=e.selectors;if(e.selectors.faq?.enabled&&z(e.selectors.faq,i,a,n),e.selectors.panels)for(let l of e.selectors.panels.variants){let c={...e.selectors.panels,...l};c.enabled&&H(c,i,a,n)}e.selectors.sites?.enabled&&J(e.selectors.sites,i,a,n)},100);r([]);let o=document.querySelector(e.selectors.mutationContainer),s=new MutationObserver(r);return o&&s.observe(o,{subtree:!0,childList:!0}),()=>{s.disconnect(),document.querySelectorAll(`.${g}`).forEach(t=>t.remove())}}export{V as default};
//# sourceMappingURL=init-NNEJU3PF.js.map

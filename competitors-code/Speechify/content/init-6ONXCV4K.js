import{a as Ee}from"./chunk-GQ7NJON5.js";import{a as Ce}from"./chunk-QLI6FAGW.js";import{a as ye}from"./chunk-Z37HPPTH.js";import"./chunk-73BVSBN2.js";import{c as ce,d as ue,l as fe,m as pe}from"./chunk-LBZ34ZL2.js";import"./chunk-SI7CO4VP.js";import"./chunk-JAWPO7FD.js";import{b as de}from"./chunk-N3ET5YJZ.js";import"./chunk-LXDXREIX.js";import{a as V}from"./chunk-VYK2SFTV.js";import"./chunk-PJRECGUK.js";import{$a as v,Ab as me,Ac as H,Ca as ie,Wc as N,Xc as ge,_a as G,ab as T,bb as U,db as se,ha as q,lb as le,ua as re}from"./chunk-6VFX2JNU.js";import{k as D,p as O,v as L}from"./chunk-LUKOAFYK.js";import{f as te,g as F,j as k}from"./chunk-O77QQVYU.js";import"./chunk-35EEQS33.js";import"./chunk-BGIN6QNH.js";import"./chunk-UQBFOPQH.js";import{d as oe}from"./chunk-6HLOLWYC.js";import"./chunk-XFWXZVUM.js";import"./chunk-D2ACMGPV.js";import{b as W,k as ae}from"./chunk-NORECDYR.js";import{b as ee,f as $e,g as ne}from"./chunk-RQERJHUS.js";import{d as S,h as s,j as preactH,l as C,n as R,o as l}from"./chunk-NUN3A7RC.js";l();s();R();l();s();$e();l();s();R();l();s();var A=S(ne()),we=S(D());l();s();var _e=S(D());l();s();l();s();var Ye="div.nH",je=".aDh > table tr:nth-child(1)",Xe=".Am.Al.editable";var Ke="div.h7[aria-expanded]",ze="div.ii.gt",Je=".adP",be="data-message-id",Ze=`[${be}]`,et=".gmail_quote";var Te=e=>e?.selectors?.main||Ye,he=e=>e?.selectors?.composeToolbar||je,Se=e=>e?.selectors?.composeEmailBody||Xe;var Q=e=>e?.selectors?.messageContainer||Ke,Ge=e=>e?.selectors?.messageBody||ze,Ie=e=>e?.selectors?.messageBodyFallback||Je,Me=e=>e?.selectors?.messageIdElement||Ze,xe=e=>e?.selectors?.messageIdAttributeName||be,Oe=e=>e?.selectors?.messageQuoteArea||et;var tt=e=>{let t=e.nodeType===Node.ELEMENT_NODE?e:e.parentElement;return t?re(t):!1},_=e=>{let t=a=>a(e),n=()=>{let a=t(Q);return Array.from(document.querySelectorAll(a))},o=a=>me({startingNode:a,ignoreCache:!0,shouldFindHeadings:!1,minimumTotalCharThresholdForGaussianHeuristic:4,getAllTextBlocksInitialThreshold:1}).filter(tt),r=a=>{let c=t(Me),f=t(xe),p=a.querySelector(c)?.getAttribute(f)??"";return p||oe(new Error("Message ID not found in message view"),{type:"gmail-rewrite"}),p};return{getMessageViews:n,getParagraphs:o,getMessageId:r,findMatchingMessageView:a=>n().find(p=>r(p)===a)||null,findMessageViewForParagraph:a=>{let c=t(Q);return a.closest(c)},getMessageViewBody:a=>a.querySelector(t(Ge))||a.querySelector(t(Ie)),getMessageViewBodyQuotedArea:a=>{let c=t(Oe);return a.querySelector(c)},getToWhomDiv:a=>a.querySelector(".ady")}};l();s();l();s();var Le=e=>e.nodeType===Node.TEXT_NODE||["inline","inline-block"].includes(getComputedStyle(e).display),$=e=>e.every(Le),ot=(e,t)=>{let n=document.createElement("span");e.forEach((o,r)=>{n.appendChild(o.cloneNode(!0)),r!==e.length-1?t.removeChild(o):t.replaceChild(n,o)})},ve=e=>{let t=Array.from(e.childNodes);if($(t))return;let n=!1;t.reduce((r,i)=>{let m=Le(i);return m&&(n?r[r.length-1].elements?.push(i):r[r.length]={elements:[i],parentElement:i.parentElement}),n=m,r},[]).forEach(r=>{r.elements.length>1&&ot(r.elements,r.parentElement)})};var nt=["gmail_attr","h5",".gmail_signature"],Y=e=>{if(e instanceof HTMLElement&&nt.some(o=>e.classList.contains(o)))return[];ve(e);let t=Array.from(e.childNodes);return t.length===0||$(t)?[{text:e.textContent??"",elem:e}]:t.flatMap(o=>o.nodeType===Node.TEXT_NODE?[{text:o.textContent??"",elem:o}]:o.nodeType===Node.ELEMENT_NODE?Y(o):[]).filter(o=>o.text.trim().replace(/\n|\r\n/,"").length>0).filter(o=>(o.text.match(/\w+/)??[]).length>0)};var Ne=(e,t)=>{let n=e.getMessageViewBody(t);return n?e.getParagraphs(n):[]},I=async(e,t)=>{let{ObjectRef:n}=await q(),o=_(e),r=Ne(o,t),i=document.querySelector("div.Tm.aeJ");return{getContent:await U(async()=>({content:r.some(d=>d.isConnected)?r:Ne(o,t),chunksAfter:0,chunksBefore:0})),converter:m=>({text:V(m),ref:new n({ref:m,highlightInfo:{scrollElement:i,startOffset:0}})}),options:{autoplay:!0,sideEffects:!1},metadata:{source:"GmailInbox"}}},j=async e=>{let{ObjectRef:t}=await q(),n=Se(e),o=document.querySelector("div[speechify-play-window-id]");if(!o)return F(null);let r=o.querySelector(n);return r?te({getContent:await U(async()=>{let i=[];if(!e.shouldOnlyReadEmailBody){let m=o.querySelector("input[name=subjectbox]");m&&i.push({text:m.value,elem:m})}return i.push(...Y(r)),{content:i.map(m=>m.elem),chunksAfter:0,chunksBefore:0}}),converter:i=>({text:V(i),ref:new t({ref:i})}),options:{autoplay:!0,sideEffects:!1,experimentalEdits:async function*(i){let m=()=>new Promise(d=>{let u=[],E=()=>{c.disconnect(),d([])},a=(0,_e.debounce)(f=>{u=[],c.disconnect(),i.removeEventListener("abort",E),d(f)},1e3),c=new MutationObserver(f=>{u.push(...f),a(u)});i.addEventListener("abort",E),c.observe(r,{childList:!0,subtree:!0,characterData:!0})});for(;;)yield await m()}},metadata:{source:"GmailCompose"}}):F(null)};l();s();l();s();function Ae({avoidNumbers:e}={}){let t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";e||(n+="0123456789");for(let o=0;o<32;o++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}var Be="speechify-gmail-root";function Pe(e){Array.from(document.querySelectorAll("div[speechify-play-window-id]")).forEach(r=>r.removeAttribute("speechify-play-window-id"));let n=e.closest(".M9"),o=Ae({avoidNumbers:!0});return n?.setAttribute("speechify-play-window-id",o),n}var at=({isLoading:e,isLoadingFailed:t,isPlaying:n,playPause:o,onTooltipDismiss:r})=>preactH(de,{id:"gmail-compose-button",variant:"gmailStyle",onToolTipDismiss:r,direction:"down",text:"Listen to how your email sounds before hitting send."},preactH(fe,{onClick:o,isLoading:e,isPlaying:n,isLoadingFailed:t,"data-tooltip":"Listen to your email before sending"}));function Re({wrapper:e,config:t}){let[n,o]=(0,A.useState)(null),{usePlayingState:r,useBundleInfo:i}=v,{play:m,pause:d}=G,u=r(),E=u==="buffering",a=u==="playing",c=u==="errored",{currentContent:f}=i(),p=!!f&&f?.id===n?.id;(0,A.useEffect)(()=>{let b=new MutationObserver((0,we.debounce)(async()=>{let g=u==="playing"||u==="buffering";if(p){let y=await j(t);G.pause(),k(y)&&o(T(y.value,g))}},1e3));return b.observe(e,{childList:!0}),()=>{b.disconnect()}},[e,u,p]);let M=async()=>{if(H("extension_gmail_compose_button_clicked",{}),O()||L("browser-action",{animate:!1},"pill-player"),p)return a?d():m();Pe(e);let b=await j(t);if(k(b)){let g=T(b.value,!0);o(g)}},x=()=>{H("extension_gmail_compose_tooltip_disabled",{})};return t.playButtons&&t.playButtons.gmail&&!t.playButtons.gmail.listenBeforeSending?null:preactH(at,{isLoading:p&&E,isPlaying:p&&a,isLoadingFailed:c,playPause:M,onTooltipDismiss:x})}var X="speechify-gmail-draft-play-button-container",B;function P(){let e=document.querySelectorAll(`.${X}`);B&&B.disconnect();for(let t of Array.from(e))C(()=>null,t),t.remove()}function De(e){let t=he(e),n=document.querySelectorAll(t);for(let o of Array.from(n)){if(o.querySelector(`.${X}`))continue;let r=o.querySelector(".gU.gmail-draft-wrapper")||document.createElement("td");r.className="gU gmail-draft-wrapper";let i=document.createElement("div");i.className=X,C(preactH(Re,{wrapper:i,config:e}),i),r.appendChild(i),o.insertBefore(r,o.querySelector("td:nth-child(2)"))}}async function Fe(e){De(e),B=new MutationObserver(()=>{De(e)}),B.observe(document,{subtree:!0,childList:!0})}l();s();var He=S(D());R();l();s();var h=S(ne());var lt=ae(se)`
  position: relative;
  flex-direction: row;
  align-items: center;
  overflow: hidden;
  cursor: pointer;
  justify-content: center;
  gap: 6px;
  margin-left: 8px;
  padding: 4px 6px;
  border-radius: 6px;

  &:hover {
    background-color: ${({styleThemes:e})=>e.hoverBackgroundColor};

    > button {
      ${({styleThemes:e})=>e.hoverButtonColor?`border: 1.8px solid ${e.hoverButtonColor}`:""};
      color: ${({styleThemes:e})=>e.hoverButtonColor};
    }
  }

  > button {
    background: none;
    border: 1.8px solid ${({styleThemes:e})=>e.buttonColor};
    color: ${({styleThemes:e})=>e.buttonColor};
  }

  &:active {
    background-color: ${({styleThemes:e})=>e.activeBackgroundColor};
  }
`,ke={buttonColor:"#454746",iconBackground:W.bgPrimInvBW,hoverBackgroundColor:"#F2F2F2",activeBackgroundColor:"#E4E4E4"},qe={buttonColor:W.icnTxtPrimInv,iconBackground:"#1B1F23",hoverBackgroundColor:"rgba(71, 74, 77, 1)",activeBackgroundColor:"#556478"},We=({messageViewElement:e,config:t})=>{let{usePlayingState:n,useBundleInfo:o}=v,r=Ce(document.body),[i,m]=(0,h.useState)(null),{play:d,pause:u}=G,E=n(),{currentContent:a}=o(),c=!!a&&a?.id===i?.id,f=!!c&&E==="playing",p=!!c&&E==="buffering",M=E==="errored";(0,h.useEffect)(()=>{(async()=>{let g=await I(t,e);m(g)})()},[e,t]),(0,h.useEffect)(()=>{if(!e)return;let g=new MutationObserver(()=>x(!0)),y=new MutationObserver(()=>x(!1));g.observe(e,{attributes:!0,attributeFilter:["aria-expanded"],subtree:!0});let Z=document.querySelector(t.selectors.forwardedEmailExpandContent);if(Z)return y.observe(Z,{attributes:!0,attributeFilter:["aria-expanded"],subtree:!0}),()=>{g.disconnect(),y.disconnect()}},[e,t]);let x=async g=>{if(!e||g&&!c)return;let y=await I(t,e);m(y)},b=(0,h.useCallback)(async g=>{if(e&&(g.stopPropagation(),O()||L("browser-action",{animate:!1},"pill-player"),N("individual-post-button-hint"),!p)){if(f)return u();if(c)return d();if(!c&&i){let y=T(i,!0);m(y)}}},[p,f,c,d,u,i]);return t.playButtons&&t.playButtons.gmail&&!t.playButtons.gmail.listenInInbox?null:preactH(lt,{styleThemes:r?qe:ke,onClick:b},preactH(pe,{isLoading:p,isLoadingFailed:M,isPlaying:f,iconSize:"20px",onClick:b}),preactH(le,{color:r?qe.buttonColor:ke.buttonColor,fontSize:"14px",fontFamily:"Google Sans",letterSpacing:"0.2px",medium:!0},f?"Pause":"Listen"))};var K="speechify-gmail-inbox-play-button-container-v2",mt="ady",z,Ue=(0,He.debounce)((e,t,n)=>{if(ct(e))return;let o=n.getMessageViews();o&&o.forEach((r,i)=>{let m=n.getToWhomDiv(r);if(!m||m.querySelector(`.${K}`))return;let d=document.createElement("div");d.className=K,d.setAttribute(Ee,"true"),C(preactH(We,{config:t,messageViewElement:r}),d),m.appendChild(d),i===o.length-1&&I(t,r).then(u=>{u.options?.autoplay&&(u.options.autoplay=!1),T(u,!0)})})},0);async function Ve(e){Qe();let t=_(e);Ue([],e,t),z=new MutationObserver(n=>Ue(n,e,t)),z.observe(document,{childList:!0,subtree:!0})}async function w(){z.disconnect(),Qe()}async function Qe(){let e=document.querySelectorAll(`.${K}`);for(let t of e)C(()=>null,t),t.remove()}var ct=(e,t=[])=>e.some(n=>{if(n.target instanceof HTMLElement&&ut(n.target))return!0;for(let o of n.addedNodes)if(o instanceof HTMLIFrameElement&&!t.includes(o.src))return!0;for(let o of n.removedNodes)if(o instanceof HTMLIFrameElement&&!t.includes(o.src))return!0;return!1}),ut=e=>e.className?.includes("speechify")||e.id?.includes("speechify")||e.className?.includes(mt);function J({config:e}){return ee(()=>{let t=e.playButtons?.gmail;return(!t||t&&t.listenInInbox)&&Ve(e),(!t||t&&t.listenBeforeSending)&&Fe(e),()=>{w(),P()}},[]),null}async function dt(e){let t=Te(e);await ie(t);let n=document.createElement("div");return n.id=Be,document.body.append(n),C(preactH(J,{config:e}),n),ft(),()=>{P(),w(),C(()=>null,n),n.remove()}}var ft=async()=>{let e="gmail",t=await ce("SHOULD_SHOW_PLAY_BUTTON_HINT");if(t.includes(e)===!0){N("individual-post-button-hint");return}await ge({allowPointerActions:!0,component:!0,duration:0,id:"individual-post-button-hint",priority:101,showOnMobile:!1,timeSensitive:!0,render:()=>preactH(ye,null)}),await ue("SHOULD_SHOW_PLAY_BUTTON_HINT",[...t,e])};export{dt as default};
//# sourceMappingURL=init-6ONXCV4K.js.map

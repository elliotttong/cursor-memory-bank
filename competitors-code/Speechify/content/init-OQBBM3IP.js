import{a as ot}from"./chunk-MZJO7N7V.js";import{a as tt}from"./chunk-QLI6FAGW.js";import{b as Oe,c as Ne,d as _e,e as Me,f as $e,g as ze,h as M,i as We,j as Xe,k as Qe,l as Ye,m as je,r as Ze}from"./chunk-FJMP4XPS.js";import"./chunk-BRU4RAVQ.js";import{P as Ue,Q as $,R as A,S as Ve,T as Ge,W as Je}from"./chunk-QEP7SRH7.js";import"./chunk-OFYWCEWM.js";import"./chunk-TVWAVI6A.js";import"./chunk-CVF2X5Y4.js";import{q as _}from"./chunk-LBZ34ZL2.js";import"./chunk-SI7CO4VP.js";import"./chunk-JAWPO7FD.js";import{a as De}from"./chunk-N3ET5YJZ.js";import"./chunk-LXDXREIX.js";import{a as et}from"./chunk-VYK2SFTV.js";import"./chunk-MQX2TL35.js";import{a as qe}from"./chunk-SWWFND36.js";import"./chunk-PJRECGUK.js";import{$a as S,Ac as v,Da as Ee,Fa as Te,Oa as Pe,Pa as H,Qa as Be,Yb as He,_a as D,ab as Ae,bb as Re,cb as Fe,d as be,db as B,ja as Se,lb as Ke,za as we}from"./chunk-6VFX2JNU.js";import{n as Ce,p as ve,r as Ie,v as k}from"./chunk-LUKOAFYK.js";import{a as xe}from"./chunk-O77QQVYU.js";import"./chunk-35EEQS33.js";import{i as Kt}from"./chunk-BGIN6QNH.js";import"./chunk-UQBFOPQH.js";import{d as ke}from"./chunk-6HLOLWYC.js";import"./chunk-XFWXZVUM.js";import"./chunk-D2ACMGPV.js";import{a as he,b as C,c as O,g as N,h as Le,k as n}from"./chunk-NORECDYR.js";import{g as I}from"./chunk-RQERJHUS.js";import{d as T,h as f,j as preactH,k as Fragment,l as P,n as ye,o as u}from"./chunk-NUN3A7RC.js";u();f();ye();u();f();var d=T(I());var mt=T(Kt());u();f();var nt={textColor:"#1E1E1E",csatIconFill:"#587393",csatTextColor:"#587393",closeBtnFill:"#587393",closeBtnHover:"#dee5eb",jumpIconFill:"#6B78FC",csatSeparatorColor:"#e4eaf1",speechifyLogoColor:"#2137FC",tooltip:{background:"#111112",text:"#FCFEFE"},closeBtnDropdown:{text:"#1e1e1e",background:"#fff",backgroundHover:"#e4eaf1"},listenBtn:{static:"#6B78FC",hover:"#9BA3FF",active:"#6870CC",textColor:"#fff"},modal:{background:"#fff",border:"1px solid #e4eaf1",text:"#1e1e1e",btnText:"#fff",btnDisabled:"#E4EAF1",btnDisabledText:"#8791A0",btnBg:"#2137FC",btnSimpleText:"#587393",radioBg:"#e4eaf1",radioFill:"#fff",radioBorder:"#2137fc",textAreaBorder:"#c9ced4",textAreaBg:"#fff"},background:"radial-gradient(43.11% 51.96% at 30.5% 59.96%, rgba(45, 214, 92, 0.02) 0%, rgba(53, 143, 78, 0.00) 100%), radial-gradient(61.75% 102.86% at 76.75% 70.46%, rgba(226, 41, 197, 0.03) 0%, rgba(205, 62, 182, 0.00) 100%), radial-gradient(96.95% 118.17% at 73% 26.15%, rgba(48, 138, 221, 0.05) 0%, rgba(29, 41, 53, 0.00) 100%), linear-gradient(155deg, rgba(145, 205, 255, 0.04) 0%, rgba(145, 205, 255, 0.00) 102.86%), #FFF",border:"1px solid #e4eaf1"},it={textColor:C.icnTxtPrim,csatIconFill:"#AFB9C8",csatTextColor:"#AFB9C8",closeBtnFill:"#AFB9C8",closeBtnHover:"#505050",jumpIconFill:"#6B78FC",csatSeparatorColor:"#373737",speechifyLogoColor:"#FFFFFF",tooltip:{background:"#F1F4F9",text:"#1e1e1e"},modal:{background:"#1e1e1e",border:"1px solid #373737",text:"#fff",btnText:"#111112",btnDisabled:"#373737",btnDisabledText:"#8791A0",btnSimpleText:"#AFB9C8",btnBg:"#5F9BF0",radioBg:"#373737",radioFill:"#fff",radioBorder:"#6B78FC",textAreaBorder:"#646464",textAreaBg:"#1E1E1E"},closeBtnDropdown:{text:"#fff",background:"#1e1e1e",backgroundHover:"#373737"},listenBtn:{static:"#6B78FC",hover:"#7DAFDC",active:"#73A0C8",textColor:"#fff"},background:"radial-gradient(43.11% 51.96% at 30.5% 59.96%, rgba(45, 214, 92, 0.08) 0%, rgba(53, 143, 78, 0.00) 100%), radial-gradient(61.75% 102.86% at 76.75% 70.46%, rgba(226, 41, 197, 0.12) 0%, rgba(205, 62, 182, 0.00) 100%), radial-gradient(96.95% 118.17% at 73% 26.15%, rgba(48, 138, 221, 0.20) 0%, rgba(29, 41, 53, 0.00) 100%), linear-gradient(155deg, rgba(145, 205, 255, 0.12) 0%, rgba(145, 205, 255, 0.00) 102.86%), #111112",border:"none"};u();f();var z=T(I());function ee(){let[e,t]=(0,z.useState)(null);return(0,z.useEffect)(()=>((async()=>{let o=await A();t(o)})(),$.listen(o=>{t(o)})),[]),e}u();f();var rt=T(I());ye();var Dt=n.div`
  align-items: center;
  background-color: #111112;
  border-radius: 6px;
  bottom: 40px;
  color: #fff;
  cursor: pointer;
  display: flex;
  font-family: 'ABCDiatype';
  font-size: 14px;
  gap: 6px;
  line-height: 20px;
  padding: 8px 12px;
  position: absolute;
  right: 20px;
  z-index: 9999;
  pointer-events: auto;

  .esc-key-button {
    align-items: center;
    background-color: #f1f4f9;
    border: 1px solid #afb9c8;
    border-radius: 4px;
    box-shadow: 0px 1px 0px 0px rgba(175, 185, 200, 1);
    color: #1e1e1e;
    display: flex;
    font-size: 14px;
    font-weight: 400;
    height: 24px;
    justify-content: center;
    line-height: 20px;
    text-align: center;
  }
`;function at({onKeyPress:e,root:t}){let o=(0,rt.useMemo)(()=>O({key:"keypoint-emotion-cache",container:t}),[t]);return preactH(N,{value:o},preactH(Dt,{role:"button",onClick:e},preactH("div",{className:"esc-key-button"}," Click"),"to Exit Key Takeaways player"))}var st=e=>{let t=document.querySelector("#speechify-keypoint-mode");if(!t){let i=document.createElement("div");i.id="speechify-keypoint-mode",i.style.cssText="position: fixed; top: 0; right: 0; width: 100%; min-height: 100%; z-index: 2147483640; display: none !important;",document.body.appendChild(i),i.attachShadow({mode:"open"}),t=i}t.style.display="block",t.style.pointerEvents="none";let o=t?.shadowRoot;if(!o)return ke(new Error("No shadow root found for speechify selection player, cannot mount."));let r=document.createElement("div");r.id="speechify-keypoint-player",o.appendChild(r),P(preactH(at,{root:r,onKeyPress:()=>{e&&(D.pause(),e.options?.autoplay&&(e.options.autoplay=!1),Ae(e,!0)),te()}}),r)},te=()=>{let e=document.querySelector("#speechify-keypoint-mode"),t=e?.shadowRoot;if(!t||!e)return;e.style.display="none",e.style.pointerEvents="auto";let o=t.getElementById("speechify-selection-player");o&&(P(null,o),o.remove())};u();f();var lt=T(I());var Ot=n(B)`
  background: ${e=>e.theme.listenBtn.static};
  border-radius: 100px;
  cursor: pointer;

  &:hover {
    background: ${e=>e.theme.listenBtn.hover};
    animation: none;
  }

  // change color to "Listen to email" text when hovered
  &:hover + span {
    color: ${C.icnTxtPrimElectric};
  }

  &:active {
    background: ${e=>e.theme.listenBtn.active};
    animation: none;
  }

  &:active + span {
    color: #6870cc;
  }

  outline: inherit;
  border: none;
  height: inherit;

  // handle keyboard navigation since we are removing outline
  &:focus-visible {
    outline: 1px solid ${C.brdrPrimCta};
    border: 1px solid #fff;
  }
`,an=n(B)`
  font-size: 12px;
  font-family: ABCDiatype, sans-serif;
  font-style: normal;
  font-weight: 500;
  line-height: 12px;
  letter-spacing: 0.12px;
  color: ${e=>e.theme.listenBtn.textColor};
`,Nt=({isPlaying:e,isLoading:t,...o})=>{let r=(0,lt.useMemo)(()=>t?"loading":e?"playing":"paused",[e,t]);return preactH(B,{...o},r==="playing"&&preactH(_e,null),r==="loading"&&preactH(Oe,null),r==="paused"&&preactH(Ne,null))};function _t({isLoading:e,isPlaying:t,playPage:o,theme:r}){return preactH(Ot,{yAlign:!0,relative:!0,column:!1,onClick:i=>o(i)},preactH(Nt,{size:"32",iconFill:r.listenBtn.textColor,isLoading:e,isPlaying:t}))}var ct=_t;u();f();var oe=T(I());var $t=n.div`
  z-index: 100000;
  align-items: center;
  background-color: rgba(5, 7, 11, 0.5);
  display: flex;
  height: 100vh;
  justify-content: center;
  left: 0;
  position: fixed;
  top: 0;
  width: 100vw;
`,zt=n.div`
  border: ${e=>e.theme.modal.border};
  background: ${e=>e.theme.modal.background};
  border-radius: 12px;
  color: ${e=>e.theme.modal.text};
  display: flex;
  flex-direction: column;
  font-family: ABCDiatype, sans-serif;
  min-width: 380px;
  padding: 20px 40px;
  position: relative;
`,Wt=n.div`
  cursor: pointer;
  position: absolute;
  right: 10px;
  top: 10px;
`,Xt=n.h3`
  color: ${e=>e.theme.modal.text};
  text-align: center;
  font-family: 'ABCDiatype', sans-serif;
  font-size: 18px;
  font-style: normal;
  font-weight: 700;
  line-height: 24px;
`,Qt=n.form`
  display: flex;
  flex-direction: column;
  gap: 16px;
`,Yt=n.div`
  align-items: center;
  display: flex;

  & label {
    height: 100%;
    cursor: pointer;
    font-size: 14px;
    font-style: normal;
    font-weight: 400;
    line-height: 20px;
    letter-spacing: 0.14px;
  }
`,jt=n.input`
  appearance: none;
  background-color: ${e=>e.theme.modal.radioBg};
  border: 6px solid transparent;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
  transition: border-color 0.3s;
  margin-right: 8px;

  &:checked {
    border-color: ${e=>e.theme.modal.radioBorder};

    &::before {
      content: '';
      display: block;
      width: 8px;
      height: 8px;
      background-color: ${e=>e.theme.modal.radioFill};
      border-radius: 50%;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
  }
`,qt=n.div`
  display: flex;
  gap: 24px;
  justify-content: center;
  margin-top: 8px;

  & > button {
    font-family: ABCDiatype, sans-serif;
    font-size: 14px;
    padding: 8px 36px 6px 36px;
  }
`,Ut=n.div`
  display: flex;
  flex-direction: column;
  gap: 8px;
`,Vt=n.textarea`
  border-radius: 6px;
  border: 1px solid ${e=>e.theme.modal.textAreaBorder};
  background: ${e=>e.theme.modal.textAreaBg};
  color: ${e=>e.theme.modal.text};
  min-height: 100px;
  padding: 10px;
  resize: none;
  font-family: ABCDiatype, sans-serif;
  font-size: 14px;
  font-weight: 400;
  line-height: 20px;
  letter-spacing: 0.14px;
`,Gt=[{label:"Summary is too lengthy",id:"too-long"},{label:"Summary misses important details",id:"miss-important-details"},{label:"Prefer reading full article",id:"prefer-reading-all"},{label:"Prefer a different summary style",id:"prefer-different-style"},{label:"It interferes with content on the page",id:"interferes-with-content"},{label:"Add a custom reason",id:"custom-response",collectCustomResponse:!0}],Jt=({show:e,variant:t,onDismiss:o,onSubmit:r,theme:i})=>{let[a,s]=(0,oe.useState)(),[l,g]=(0,oe.useState)(""),y=async c=>{c.preventDefault(),a&&await v("extension_keypoints_extraction_feedback",{channel:t,response:l||a.label}),r()},m=c=>{s(c)};return e?preactH($t,null,preactH(zt,null,preactH(Wt,{onClick:o},preactH(M,{fill:"#587393"})),preactH(Xt,null,t==="csat"?"Tell us what you didn’t like about summary":"Why you want to turn off summarization?"),preactH(Qt,{onSubmit:y},Gt.map(c=>preactH(Yt,{key:c.id},preactH(jt,{checked:a&&a.id===c.id,id:c.id,name:"modal-key-points",onChange:()=>m(c),type:"radio",value:c.id}),preactH("label",{htmlFor:c.id},c.label))),(!a||!a.collectCustomResponse)&&preactH(qt,null,preactH(_,{type:"button",onClick:o,style:{color:i.modal.btnSimpleText,border:"none",boxShadow:"none"},secondary:!0},"Cancel"),preactH(_,{type:"submit",disabled:!a,style:{display:"flex",cursor:a?"pointer":"not-allowed",alignItems:"center",color:a?i.modal.btnText:i.modal.btnDisabledText,background:a?i.modal.btnBg:i.modal.btnDisabled}},"Confirm")),a&&a.collectCustomResponse&&preactH(Ut,null,preactH(Vt,{onChange:c=>g(c.target.value),placeholder:"Tell us what you don’t like about summarization"}),preactH(_,{type:"submit",disabled:!l,style:{display:"flex",alignItems:"center",justifyContent:"center",color:l?i.modal.btnText:i.modal.btnDisabledText,background:l?i.modal.btnBg:i.modal.btnDisabled,width:"100%",textAlign:"center"}},"Submit Feedback"))))):null},dt=Jt;var to=n.div`
  border: 0.5px solid #3c3c3e;
  background: #1e1e1f;
  margin-top: 1rem;
  margin-bottom: 1rem;
  max-height: 700px;
  width: 100%;
  padding: 0;
  border-radius: 16px;
  display: flex;
  flex-direction: column;
`,oo=n.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 16px 8px 16px;
`,no=n.div`
  display: flex;
  align-items: center;
  gap: 8px;
`,io=n.span`
  font-family: 'ABC Diatype';
  font-size: 16px;
  font-style: normal;
  font-weight: 500;
  line-height: 24px; /* 150% */
  letter-spacing: 0.16px;
  color: #ffffff;
`,ro=n.div`
  display: flex;
  gap: 8px;
  align-items: center;
`,pt=n.div`
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;

  & .tooltip {
    display: none;
  }

  &:hover .tooltip {
    display: flex;
  }

  &:active .tooltip {
    display: flex;
  }
`,ao=n(Me)`
  cursor: pointer;

  &:hover {
    opacity: 0.75;
  }

  &:active {
    opacity: 0.5;
  }
`,so=n.div`
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;

  & svg > path {
    fill: #9899a6;
  }

  &:hover svg {
    opacity: 0.75;
  }

  &:active svg {
    opacity: 0.5;
  }
`,lo=n.h3`
  font-family: ABCDiatype, sans-serif;
  font-size: 16px;
  font-style: normal;
  font-weight: 500;
  line-height: 24px; /* 150% */
  letter-spacing: 0.16px;
  color: #ffffff;
  margin: 0;
`,co=n.span`
  font-family: ABCDiatype;
  font-size: 12px;
  font-style: normal;
  font-weight: 400;
  line-height: 16px; /* 133.333% */
  letter-spacing: 0.12px;
  color: #747580;
`,W=n.div`
  height: 16px;
  border-radius: 2px;
  background: #262940;
  width: 100%;
  position: relative;
  overflow: hidden;
`,X=n.div`
  @keyframes shimmer {
    100% {
      transform: translateX(150%);
    }
  }

  animation: shimmer 2s infinite;
  position: absolute;
  left: 0;
  top: 0;
  height: 100%;
  width: 80%;
  background: linear-gradient(to right, transparent, #2a2f57, transparent);
  pointer-events: none;
  transform: translateX(-150%);
`,po=n.div`
  display: flex;
  padding: 12px 16px 24px 16px;
  flex-direction: column;
  align-items: flex-start;
  gap: 12px;
  align-self: stretch;

  > div:nth-child(odd) {
    width: 60%;
  }
  > div:nth-child(even) {
    width: 70%;
  }
`,mo=n.div`
  padding: 12px 3px 0px 16px;
  position: relative;
`,fo=n.ul`
  margin: 0;
  text-align: left;
  padding: 0px 19px 24px 0px;
  overflow-x: hidden;
  overflow-y: scroll;
  will-change: max-height;
  max-height: ${({expanded:e})=>e?"240px":"72px"};

  // Animation definitions
  @keyframes expand {
    from {
      max-height: 72px;
    }
    to {
      max-height: 240px;
    }
  }

  @keyframes collapse {
    from {
      max-height: 240px;
    }
    to {
      max-height: 72px;
    }
  }

  animation: ${({expanded:e})=>e&&"expand 350ms ease-in-out forwards"};

  &::-webkit-scrollbar {
    width: 6px;
    height: 48px;
  }

  &::-webkit-scrollbar-track {
    border-radius: 1--px;
    background-color: 'transparent';
  }

  &::-webkit-scrollbar-thumb {
    border-radius: 4px;
    background-color: #3c3c3e;
  }

  &::-webkit-scrollbar-button {
    display: none;
  }
`,uo=n.span`
  display: inline;
  font-family: ABCDiatype, sans-serif;
  font-size: 16px;
  font-style: normal;
  font-weight: 400;
  line-height: 24px;
  position: relative;
  color: #ffffff;
  -webkit-font-smoothing: antialiased;
  margin-right: 4px;
`,go=n.div`
  display: flex;
  justify-content: center;
  padding: 12px 16px 16px;
`,yo=n.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
`,ho=n.div`
  display: flex;
  align-items: center;
  gap: 12px;
`,xo=n.div`
  display: flex;
  align-items: center;
  width: 200px;
  height: 36px;
  border-radius: 10px;
  gap: 3px;
  background: #252627;
  position: relative;
  cursor: pointer;
  justify-content: center;

  > span {
    color: #ffffff;
    font-family: 'ABC Diatype';
    font-size: 14px;
    font-style: normal;
    font-weight: 500;
    line-height: 20px; /* 142.857% */
    letter-spacing: 0.14px;
    -webkit-font-smoothing: antialiased;
    text-rendering: optimizeLegibility;
  }

  &:hover {
    background: #2d2d2f;
  }

  &:active {
    background: #3c3c3e;
  }
`,bo=n(Ye)`
  margin-left: -8px;
`,Co=n(Qe)`
  position: absolute;
  top: 5px;
  right: 5px;
`,vo=n.li`
  line-height: 24px;
  color: ${e=>e.theme.textColor};
  text-align: left;
`,Q=n.span`
  cursor: pointer;
  position: relative;
  & svg > path {
    fill: #9899a6;
  }

  &:hover svg#regenerate {
    opacity: 0.75;
  }

  &:active svg#regenerate {
    opacity: 0.5;
  }

  &:hover svg#copy {
    opacity: 0.75;
  }

  &:active svg#copy {
    opacity: 0.5;
  }

  ${({chooseResponse:e})=>e==="good"&&`
    svg#like > path {
      fill: #23ae75;
    }
  `}

  &:hover svg#like > path {
    fill: #23ae75;
  }

  &:active svg#like > path {
    fill: #23ae75;
    opacity: 0.75;
  }

  ${({chooseResponse:e})=>e==="bad"&&`
    svg#dislike > path {
      fill: #eb3830;
    }
  `}

  &:hover svg#dislike > path {
    fill: #eb3830;
  }

  &:active svg#dislike > path {
    fill: #eb3830;
    opacity: 0.75;
  }

  & .tooltip {
    display: none;
  }

  &:hover .tooltip {
    display: flex;
  }

  &:active .tooltip {
    display: flex;
  }

  height: 20px;
  width: 20px;
`,ko=n.div`
  width: 2px;
  height: 10px;
  min-width: 2px;
  border-radius: 30px;
  background: #3c3c3e;
`,Vn=n.span`
  position: relative;
  opacity: ${({visible:e})=>e?1:0};
  ${({visible:e})=>!e&&"pointer-events: none;"}
  transition: opacity 0.25s ease-in-out;
`,Gn=n.div`
  background: ${e=>e.theme.tooltip.background};
  border-radius: 4px;
  color: ${e=>e.theme.tooltip.text};
  font-family: ABCDiatype, sans-serif;
  font-size: 14px;
  ${({showOnRight:e=!1})=>e?"left: 30px;":"right: 30px"};
  line-height: 16px;
  padding: 4px 8px;
  position: absolute;
  top: 0;
  width: max-content;
`,So=n.button`
  color: white;
  background: transparent;
  border: none;
  font-size: 14px;
  font-family: ABCDiatype, sans-serif;
  font-weight: 500;
  line-height: 20px; /* 142.857% */
  display: flex;
  align-items: center;
  gap: 6px;
  justify-content: center;
  outline: none;
  margin-right: auto;
  cursor: pointer;
  padding: 0;
  > svg {
    fill: white;
    width: 12px;
    height: 12px;
    padding: 2px;
  }

  &:hover {
    opacity: 0.75;
  }

  &:active {
    opacity: 0.5;
  }
`,wo=n.div`
  width: calc(100% - 38px);
  background: linear-gradient(
    180deg,
    rgba(30, 30, 31, 0) 0%,
    rgba(30, 30, 31, 0.9) 80%,
    rgba(30, 30, 31, 0.99) 95%,
    #1e1e1f 100%
  );
  position: absolute;
  bottom: 0;
  height: 32px;
  z-index: 1;
`,Eo=n(B)`
  position: absolute;
  z-index: 2000;
  bottom: 34px;
  right: 0px;
  transform: translateX(calc(50% - 12px));
  font-family: 'ABCDiatype';
  font-style: normal;
  border-radius: 6px;
  padding: 6px 8px;
  box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.16);
  color: ${C.icnTxtPrimInv};
  background-color: #e9eaf0;

  ::before {
    content: '';
    display: block;
    width: 0;
    height: 0;
    position: absolute;
    left: calc(50% - 4px);
    top: 100%;
    border-style: solid;
    border-width: 4px;
    border-color: #e9eaf0 transparent transparent transparent;
  }

  ::after {
    content: '';
    display: block;
    position: absolute;
    width: 0;
    height: 0;
    left: calc(50% - 3px);
    top: 100%;
    border-style: solid;
    border-width: 3px;
    border-color: #e9eaf0 transparent transparent transparent;
  }
`,To=n(Ke)`
  font-weight: 400;
  font-size: 12px;
  line-height: 16px;
  letter-spacing: 0.01em;
  width: max-content;
  color: ${C.icnTxtPrimInv};
`;function Po({root:e,skipEnabledCheck:t}){let{seekTo:o}=D,r=ee(),[i,a]=(0,d.useState)([]),[s,l]=(0,d.useState)(!0),[g,y]=(0,d.useState)(!1),[m,c]=(0,d.useState)(!1),[b,yt]=(0,d.useState)({show:!1,variant:"csat"}),[ht,xt]=(0,d.useState)(null),[re,bt]=(0,d.useState)(0),[F,ae]=(0,d.useState)(!0),[Ct,se]=(0,d.useState)(!1),[L,le]=(0,d.useState)(),V=(0,d.useRef)(null),ce=tt(e),G=(0,d.useMemo)(()=>ce?it:nt,[ce]),vt=(0,d.useMemo)(()=>O({key:"keypoints-emotion-cache",container:e}),[e]),K=(0,d.useMemo)(()=>He(),[window.location.hostname]),{state:de,play:kt,pause:St,isActive:J,queueAndPlayContent:wt}=Pe(ht),Et=!!(J&&de==="buffering"),pe=!!(J&&de==="playing"),me=()=>{ae(!0)},fe=p=>{ae(!1),a(p.sentences)};(0,d.useEffect)(()=>(w.on("loading",me),w.on("success",fe),()=>{w.off("success",fe),w.off("loading",me)}),[w]),(0,d.useEffect)(()=>{(async()=>{let p={getContent:await Re(async()=>({content:Array.from(V.current?.querySelectorAll("li")??[]),chunksBefore:0,chunksAfter:0})),converter:h=>({text:et(h),ref:new mt.ObjectRef({ref:h,highlightInfo:{scrollElement:V.current??void 0,startOffset:0,isKeypoint:!0}})}),metadata:{source:"Keypoints"},options:{autoplay:!0,sideEffects:!1}};Be(p).then(h=>{bt(h)}),xt(p)})()},[i]),(0,d.useEffect)(()=>{l(!!(t||r?.enabled_by_default&&!r?.disabled_websites.includes(K)||r?.enabled_websites.includes(K)))},[r,t,K]);let Tt=async p=>{if(g||y(!0),p.preventDefault&&p.stopPropagation&&(p.preventDefault(),p.stopPropagation()),v("extension_keypoints_extraction_listen_btn_clicked"),m||c(!0),ve()||k("browser-action",{animate:!1},"pill-player"),pe)return St();if(J)return kt();let h=S.getBundleState().currentContent;h&&st(h),wt()},Z=()=>{switch(b.variant){case"csat":yt(p=>({...p,show:!1}));break}},Pt=async()=>{switch(b.variant){case"csat":Z();break;case"dismiss":await Ve("enabled_by_default",!0),l(!1),Z();break}},ue=p=>{p==="upvote"?(le("good"),v("extension_keypoints_extraction_upvoted")):(le("bad"),v("extension_keypoints_extraction_downvoted"))},Bt=()=>{Ze("/aiSummary"),v("extension_usage_settings_clicked",{source:"keypoints_extraction"}),k("show-settings-modal")},It=()=>{window.open(he.speechifyWebApp.baseUrl,"_blank")},At=()=>{k("onetime-keypoint-extraction",{},"keypoint-extraction")},Rt=()=>{let p=i.map(h=>h.sentence).join(`
`);navigator.clipboard.writeText(p),se(!0),setTimeout(()=>{se(!1)},5e3)},Ft=()=>{k("destroy",{},"keypoint-extraction")},Lt=()=>{v("extension_keypoints_extraction_close_dropdown_option_clicked",{option:"current-page"}),Ge(K),l(!1),Ft()},E=({text:p})=>preactH(Eo,{className:"tooltip"},preactH(To,null,p)),ge=i.length>3;if(s)return preactH(N,{value:vt},preactH(Le,{theme:G},preactH(dt,{theme:G,show:b.show,variant:b.variant,onDismiss:Z,onSubmit:Pt}),preactH(to,{id:"speechify-keypoints-extractor-body"},preactH(oo,null,preactH(no,null,F?preactH(je,null):preactH(ct,{theme:G,playPage:Tt,isLoading:Et,isPlaying:pe}),F&&preactH(io,null,"Analyzing Text"),!F&&(g?preactH(ot,{style:{marginLeft:"8px",marginRight:"16px"},customStyle:{timeLabelColor:"#ffffff",seekbarColor:"url(#grad1)",seekHandleColor:"linear-gradient(315deg, #EA6AFF 0%, #6B78FC 100%)"},duration:re,seek:o,disabledSeek:!0}):preactH(lo,null,"Listen to Speechify Summary ",preactH(co,null,"·")," ",Ce("long")(re)))),preactH(ro,null,preactH(pt,null,preactH(ao,{onClick:Bt}),preactH(E,{text:"Customize summary"})),preactH(pt,null,preactH(so,null,preactH(M,{onClick:Lt,fill:"#9899A6"}),preactH(E,{text:"Turn off for this site"}))))),F?preactH(po,null,preactH(W,null,preactH(X,null)),preactH(W,null,preactH(X,null)),preactH(W,null,preactH(X,null)),preactH(W,null,preactH(X,null))):preactH(Fragment,null,preactH(mo,null,preactH(fo,{ref:V,expanded:m},preactH(vo,null,i.map(p=>preactH(uo,{key:p.sentence},p.sentence.replace(/\[\d+\]/g,""))))),preactH(wo,null)),preactH(go,null,(m||!ge)&&preactH(Fragment,null,preactH(yo,null,preactH(ho,null,preactH(Q,null,preactH($e,{id:"regenerate",onClick:At}),preactH(E,{text:"Regenerate"})),preactH(Q,null,preactH(ze,{id:"copy",onClick:Rt}),preactH(E,{text:Ct?"Copied":"Copy"})),preactH(ko,null),L!=="bad"&&preactH(Q,{chooseResponse:L},preactH(We,{id:"like",onClick:()=>ue("upvote")}),preactH(E,{text:"Good response"})),L!=="good"&&preactH(Q,{style:{marginTop:"2px"},chooseResponse:L},preactH(Xe,{id:"dislike",onClick:()=>ue("downvote")}),preactH(E,{text:"Bad response"}))),preactH(xo,{onClick:It},preactH(bo,null),preactH("span",null,"Ask a Follow-up"),preactH(Co,null)))),ge&&!m&&preactH(So,{onClick:()=>{c(!m)}},"Read More",preactH(De,{direction:m?"up":"down",disableAnimation:!0})))))))}var ft=Po;u();f();var Bo=e=>[...e].sort((t,o)=>t-o),Io=(e,t)=>{let o=Bo(e),r=(o.length-1)*t,i=Math.floor(r),a=r-i;return o[i+1]!==void 0?o[i]+a*(o[i+1]-o[i]):o[i]},R=e=>{},ut=(e,t)=>{let o=e.map(l=>l.score),r=Io(o,.75),i=t==="gte"?.99:.9,s=e.filter((l,g)=>{let y=o[g-1]??0,m=o[g+1]??0,c=l.score;return c>=y&&c>=m}).filter(l=>["H1","H2","H3"].includes(l.elem.tagName)?!1:l.score>=r&&l.score>=i);return R(`Total Sentences: ${e.length}, Important Sentences: ${s.length}
    
Percent of sentences considered important: ${Math.round(s.length/e.length*1e4)/100}%`),s};async function gt(e,t,o=0){let r=0;async function i(){try{return await e()}catch(a){if(r++,r>t)throw a;return o>0&&await new Promise(s=>setTimeout(s,o)),i()}}return i()}var Ao=async e=>{if(!e)return null;let o=await H(e);return gt(()=>Je(o),3,1e3)},Y=xe(1),j=null,x=null,ne=null,U="speechify-keypoints-extractor",Ro="speechify-keypoints-extractor-root",Fo="speechify-keypoints-extractor-body",w=be({events:["loading","success"]}),Lo=async()=>{let{currentContent:e}=S.getBundleState(),t=e;if(e!==x&&x?.metadata.source==="PillPlayer"&&(t=x),!t)return document.body;let o=new Range,r=await H(t);o.setStart(r[0],0),o.setEnd(r[r.length-1],0);let i=o.commonAncestorContainer??document.body;return i.querySelector("h1")??i.childNodes[0]};async function Ko(e,t){if(await Promise.race([Ee(e?.awaitedElement??""),Se(500)]),document.querySelector(`#${U}`)&&document.querySelector(`#${Fo}`))return;let o=await Lo(),r=e?.inlinePlayerContentSelector?e?.inlinePlayerContentSelector:e?.inlinePlayerSelector,i=r?r.indexOf("::prepend")!==-1:!1,a=r?r.indexOf("::before")!==-1:!1,s=document.querySelector("#speechify-embedded-player"),l=(i?r?.replace("::prepend",""):a?r?.replace("::before",""):r)??"",g=we(l)??o,y;if(g){let m=document.createElement("div");m.id=U,m.style.position="relative",m.style.cssText=e?.inlinePlayerStyle??"width: 100%; max-width: 1200px; margin: 0 auto;";let c=m.attachShadow({mode:"open"}),b=g.parentNode;s?b.insertBefore(m,s):i?b.prepend(m):b.insertBefore(m,a?g.previousElementSibling:g.nextElementSibling),y=document.createElement("div"),y.id=Ro,c.appendChild(y),e?.inlinePlayerContentStyle&&(y.style.cssText=e.inlinePlayerContentStyle),P(preactH(ft,{root:y,skipEnabledCheck:t}),y)}return()=>{y&&P(null,y)}}var ie=null,Do=["google.com","github.com","huggingface.com","speechify.com"],Oo=e=>{let t=new URL(e);return t.pathname==="/"||t.pathname==="/home"||t.pathname==="/home/"},q=async(e,t,o,r,i)=>{let a=window.location.hostname.replace(/^www\./,"");if(t&&!(!i&&(!e.enabled_by_default&&!e.enabled_websites.includes(a)||e.disabled_websites.includes(a)||document.querySelector(`#${U}`)&&e.enabled_websites.includes(a)))&&!Do.some(s=>window.location.href.includes(s))&&!Oo(window.location.href)){ie&&(ie(),x=null,j=null,ne=null),ie=await Ko(o,i)??null;try{let s=t;t!==x&&x?.metadata.source==="PillPlayer"&&(s=x),(t!==x||e.ranking_mechanism!==j?.ranking_mechanism)&&(R("Attempting to break content down by sentences and perform keypoint extraction"),ne=await Ao(s),x=t),(j!==e||x!==t)&&(R("Applying highlights to content"),await Promise.race([new Promise(l=>r.addEventListener("abort",l,{once:!0})),new Promise(async l=>{let g=ut(ne,e.model);if(!g.length)throw new Error("No important sentences found");w.emit("success",{sentences:g}),j=e,R("Finished applying highlights to content"),l()})]))}catch(s){let l=new Error("Failed to perform keypoint extraction",{cause:s});k("keypoint-extraction-error",{},"keypoint-extraction"),console.error(l)}}},No=async()=>{let e=new AbortController,t=qe()["embedded-player"]?.config.config;if(Ie("onetime-keypoint-extraction",async()=>{let{currentContent:a}=S.getBundleState(),s=await A();s.enabled_by_default=!0,a&&Y(()=>q(s,a,t,e.signal))},"keypoint-extraction"),!await Ue())return;let o=await A();Te().then(()=>{let{currentContent:a}=S.getBundleState();a&&Y(()=>q(o,a,t,e.signal))});let r=$.listen(async a=>{let{currentContent:s}=S.getBundleState();s&&Y(()=>q(a,s,t,e.signal))}),i=await Fe("PLAYABLE_CONTENT_UPDATED",async({changed:a})=>{let s=["Keypoints","Selection Player","Screenshot"];a.metadata.source==="Selection Player"&&te(),a&&!s.includes(a.metadata.source)&&(Y(()=>q(o,a,t,e.signal)),i())});return()=>{e.abort(),r(),i(),document.querySelector(`#${U}`)?.remove(),document.querySelector("#speechify-keypoint-mode")?.remove()}},ki=No;export{w as KeypointExtractionStateEmitter,ki as default};
//# sourceMappingURL=init-OQBBM3IP.js.map

import{Fc as g,Gc as y,Jc as _,Kc as A,Pa as f,Wc as C,Xc as a,_a as E,cb as o,e as d,lb as T,pb as P,sb as b}from"./chunk-6VFX2JNU.js";import"./chunk-LUKOAFYK.js";import{a as m}from"./chunk-O77QQVYU.js";import"./chunk-35EEQS33.js";import"./chunk-BGIN6QNH.js";import"./chunk-UQBFOPQH.js";import"./chunk-6HLOLWYC.js";import{a as c,l as p}from"./chunk-NORECDYR.js";import"./chunk-RQERJHUS.js";import{f as browser,h as l,j as preactH,o as u}from"./chunk-NUN3A7RC.js";u();l();function S(){return d.on("subscriptionupdate",async e=>{!e||_(e)||A(e)||a({id:"subscription-expired",duration:5e3,showOnMobile:!1,timeSensitive:!0,priority:100,render:({dismiss:i})=>preactH(b,{removeNotification:i},preactH(T,null,"Your subscription has expired!",preactH("br",null),"Please renew"," ",preactH(P,{href:p(`onboarding/sso/?extensionId=${browser.runtime.id}&source=subscription_ended_notification`,c.onboardingUrl),target:"_blank",rel:"noopener noreferrer"},"here")))})})}async function N(e){return o("PLAYABLE_CONTENT_UPDATED",async({changed:i})=>{let t=i;if(!t||e?.disabled)return;(await f(t)).length===0&&!window.location.href.endsWith(".pdf")?a({id:"pill_player-ocr-recommendation",priority:151,duration:0,showOnMobile:!0,timeSensitive:!0}):C("pill_player-ocr-recommendation")})}var h=async()=>{let e=null,i=[],t=await o("PLAYABLE_CONTENT_UPDATED",async({changed:r})=>{e?.id!==r.id&&(e=r,e.metadata.source!==r.metadata.source&&(i.length=0))}),s=m(1),L=await E.registerHook("PLAYBACK_STATE_CHANGED",r=>s(async({state:n})=>{e&&(n==="playing"&&!i.includes("extension_usage_widget_listened_to_page")?(i.push("extension_usage_widget_listened_to_page"),y({triggeredFrom:e.metadata.source,isSelection:e.metadata.source==="Selection Player"})):n==="playing"&&i.includes("extension_usage_widget_listened_to_page")&&i.includes("ended")?(i.push("extension_usage_widget_relistened_to_page"),g({triggeredFrom:e.metadata.source,isSelection:e.metadata.source==="Selection Player"})):n==="ended"&&i.push("ended"))},r));return()=>{L(),t()}};async function I(e){let i=[S(),await N(e),await h()];return()=>{i.forEach(t=>t())}}export{I as default};
//# sourceMappingURL=init-JOZH2AF7.js.map

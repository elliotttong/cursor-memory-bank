import{j as C,o as O,p as F,q as l,u as E,v,w,x as L,y as P}from"./chunk-6VFX2JNU.js";import{b as y,k as M,q as S}from"./chunk-LUKOAFYK.js";import{a as h}from"./chunk-O77QQVYU.js";import{d as D,h as n,o as c}from"./chunk-NUN3A7RC.js";c();n();var s=D(M());c();n();c();n();var R={},U=R;var d=S(C(()=>({})));async function j(){let t=await F(O()),o=Object.values(y).reduce((e,i)=>{let a=t.features?.find(f=>f.name===i);return e[i]={status:a&&(a.lifecycles??[]).length>0?"active":"inactive",config:a?.config||{},lifecycles:a?.lifecycles||[]},e},{});t.parser&&(o["standard-player"].config=t.parser??{}),l.debug("Initializing config store with state",o),d.setState(o,!0);let r=Object.values(U).map(e=>E(e));return()=>{d.setState({},!0),r.forEach(e=>e())}}var b=[["config",j,d],["featureflags",w,v],["user",P,L]],u=S(()=>({}));async function T(){return Promise.all(b.map(([,t])=>t()))}var I=h(1);function _(){let t={};for(let[e,,i]of b)t[e]=i.getState();let o=new Set;for(let e of Object.values(t))Object.keys(e||{}).forEach(i=>o.add(i));let r=Array.from(o).reduce((e,i)=>{let a=i,f={},g="active",p=[];for(let[N,z]of Object.entries(t)){let m=z[a];f[N]=m?.config??{},g=m?.status??g,p=m?.lifecycles?.length?m?.lifecycles:p}return e[a]={status:g,config:f,lifecycles:Array.from(new Set(p))},e},{});l.debug("Updating combined state",r),u.setState(r)}var x=()=>I(_);function q(){let t=[],o=(0,s.debounce)(x,500);return b.forEach(([,,r])=>{let e=r.subscribe(o);t.push(e)}),()=>{t.forEach(r=>r())}}function A(){return u.getState()}function H(t){let o=(0,s.cloneDeep)(A());return u.subscribe(()=>{let r=A(),e=Object.keys(r).reduce((i,a)=>((0,s.isEqual)(r[a],o[a])||(i[a]=r[a]),i),{});t(r,e),o=(0,s.cloneDeep)(r)})}async function ut(){let t=await T();x();let o=q();return()=>{o(),t.map(r=>r()),u.setState({},!0)}}var ft={useConfig:u},mt=async()=>{await new Promise(t=>{let o=H(()=>{t(),o()})})};export{A as a,H as b,ut as c,ft as d,mt as e};
//# sourceMappingURL=chunk-SWWFND36.js.map

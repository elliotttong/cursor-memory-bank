import{a as oe}from"./chunk-FNFWVNK4.js";import{k as Z,t as ee}from"./chunk-LBZ34ZL2.js";import"./chunk-SI7CO4VP.js";import"./chunk-JAWPO7FD.js";import{c as X}from"./chunk-N3ET5YJZ.js";import"./chunk-LXDXREIX.js";import"./chunk-PJRECGUK.js";import{$a as C,Fa as k,M as O,Qc as R,Ta as M,Ua as D,Wa as U,Wc as te,Xa as j,_a as p,ab as _,e as F,f as I,ja as A,lb as Q,ta as $,ub as Y,vb as H,wb as g,xb as q,yb as J}from"./chunk-6VFX2JNU.js";import"./chunk-LUKOAFYK.js";import"./chunk-O77QQVYU.js";import"./chunk-35EEQS33.js";import"./chunk-BGIN6QNH.js";import"./chunk-UQBFOPQH.js";import"./chunk-6HLOLWYC.js";import"./chunk-XFWXZVUM.js";import"./chunk-D2ACMGPV.js";import{b as v,c as z,g as V,k as K}from"./chunk-NORECDYR.js";import{b as N,f as fe,g as ye}from"./chunk-RQERJHUS.js";import{d as pe,f as browser,h as c,j as preactH,l as T,n as ge,o as d}from"./chunk-NUN3A7RC.js";d();c();ge();d();c();function ie(){let{usePlayingState:e}=C,t=e(),i=t==="playing",o=t==="buffering",r=t==="errored",n=$(()=>{i?p.pause():p.play()});return preactH("div",{onClick:n,style:{display:"flex",justifyContent:"center",padding:8}},preactH(Z,{onClick:n,isLoading:o,isPlaying:i,isLoadingFailed:r,size:"22px",outlined:!0}))}d();c();var f=pe(ye());fe();var w=3;function ne({wrapper:e,isExpanded:t}){let[i,o]=(0,f.useState)(0);N(()=>{(async()=>{let me="gdocsTooltipShownCount",{gdocsTooltipShownCount:ue}=await browser.storage.local.get(me),L=Number(ue||0);o(L),L<w&&await browser.storage.local.set({gdocsTooltipShownCount:L+1})})()},[]);let r=K(X)`
    position: fixed;
    margin-bottom: -80px;
  `,{usePlayingState:n}=C,l=n(),a=l==="playing",u=l==="buffering",m=l==="errored",[s,b]=(0,f.useState)(!1);N(()=>{a&&b(!0)},[a]);let le=(0,f.useMemo)(()=>z({key:"player-emotion-cache",container:e}),[e]),ce=async()=>{p.play(),o(w),await browser.storage.local.set({gdocsTooltipShownCount:w})},de=h=>!!((h||i<w&&!s)&&!a&&!t);return preactH(V,{value:le},preactH(ee,{onClick:ce,root:e,isPlaying:a,isLoading:u,isLoadingFailed:m,color:v.sfPrimCta,hoverColor:v.sfPrimCtaHov,background:"transparent"},h=>preactH(r,{id:"gdocs-header-button",background:"rgba(20, 32, 46, 1)",display:de(h),direction:"up",tooltipStyle:{whiteSpace:"nowrap",justifyContent:"space-evenly",marginLeft:"80px"}},preactH(Q,{color:v.bgSecInv1000},"Listen to this document"))))}d();c();var se=()=>{let e;return O.on("update",({autoScrollTemporary:t})=>{if(t&&t!==e){let i=j();i!==null&&U(i)}e=t})};var W="speechify-bubble-player",E="speechify-gdocs-nudge-root",y="speechify-gdocs-nudge-root-container",S,B,x=!1,G=!1,re,be=oe({padding:0,width:40,height:40});async function P(e){await k(),re&&re.disconnect(),te("pill_player-ocr-recommendation");let t=M().map(r=>D(r)),i=Math.min(...t)??0,o=await H(e,i);_(o,!0)}async function he(e){await ve(e);let t=await I();R(t)||await ae(e),S=new URLSearchParams(window.location.search).get("tab")||"",B=q().heading||"",x=document.visibilityState==="hidden",x||await P(e);let i=F.on("userupdate",async l=>{document.querySelector(`#${E}`)?.remove(),document.querySelector(`div.${y}`)?.remove(),R(l)||G||(G=!0,await ae(e),G=!1),await P(e)}),o=()=>{requestAnimationFrame(async()=>{let l=new URLSearchParams(window.location.search).get("tab")||"";if(S&&l!==S)S=l,Y(),await P(e);else{let a=q().heading||"";a&&B!==a&&(B=a,setTimeout(()=>{J(e)},500))}})},r=async()=>{document.visibilityState!=="hidden"&&x&&(x=!1,await P(e))};document.addEventListener("visibilitychange",r),window.navigation.addEventListener("navigate",o);let n=se();return()=>{document.querySelector(`div.${W}`)?.remove(),document.querySelector(`#${E}`)?.remove(),document.querySelector(`div.${y}`)?.remove(),i(),document.removeEventListener("visibilitychange",r),window.navigation.removeEventListener("navigate",o),n()}}async function ve(e){let t=document.querySelector(e.selectors.bubbleContainer),i=40,o=0;for(;!t&&(await A(100),t=document.querySelector(e.selectors.bubbleContainer),o++,!(o>=i)););if(!t)return;if(!document.querySelector(`div.${W}`)){let n=document.createElement("div");n.classList.add(W),n.classList.add("instant-button"),n.classList.add(be),t.firstChild?.insertBefore(n,t.firstChild.childNodes[1]),T(preactH(ie,null),n)}}async function ae(e){if(document.querySelector(`#${E}`))return;let i=document.querySelector(e.selectors.leftSidebarContainer),o=document.createElement("div");o.id=E;let r=await g(e.selectors.navigationWidget),n=(a=!1)=>{let u=!1;r.classList.contains(e.selectors.navigationWidgetHidden)?(u=!1,a||g(e.selectors.navigationWidgetSummaryContainer).then(m=>{let s=m.querySelector(`.${y}`);s&&s.remove()}),o.style.cssText="position: absolute;top:70px;left:25px;height:20px;width:20px;pointer-events:all",i?.appendChild(o)):(u=!0,a||g(e.selectors.navigationWidgetSummaryContainer).then(m=>{let s=m?.querySelector(`.${y}`);s&&s.remove()}),g(e.selectors.navigationWidgetSummaryContainer).then(m=>{o.style.cssText="position: absolute;top: -4px; right:15px; height:20px;width:20px;";let s=document.createElement("div");s.className=y,s.style.cssText="margin-bottom: 15px; padding-left: 24px;";let b=document.createElement("span");b.textContent="Listen to this document",s.appendChild(b),s.appendChild(o),m.prepend(s)})),T(preactH(ne,{wrapper:o,isExpanded:u}),o)};n(!0),new MutationObserver(()=>{n()}).observe(r,{attributes:!0})}export{he as default};
//# sourceMappingURL=init-X66K6JBL.js.map

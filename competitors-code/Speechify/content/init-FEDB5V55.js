import{a as Z,b as tt}from"./chunk-LMC6HY6T.js";import{a as v}from"./chunk-GQ7NJON5.js";import{a as X}from"./chunk-QLI6FAGW.js";import{f as Y,j as H}from"./chunk-73BVSBN2.js";import{a as Q}from"./chunk-7D3ZJIMI.js";import{a as G}from"./chunk-BRU4RAVQ.js";import{Tc as J,Wc as K,ec as j}from"./chunk-6VFX2JNU.js";import{v as W}from"./chunk-LUKOAFYK.js";import"./chunk-O77QQVYU.js";import"./chunk-35EEQS33.js";import"./chunk-BGIN6QNH.js";import"./chunk-UQBFOPQH.js";import{d as U}from"./chunk-6HLOLWYC.js";import{c as $,g as z}from"./chunk-NORECDYR.js";import{d as M,e as q,f as lt,g as x}from"./chunk-RQERJHUS.js";import{d as A,h as p,j as preactH,l as k,n as ct,o as b}from"./chunk-NUN3A7RC.js";b();p();ct();b();p();lt();b();p();var S=A(x());b();p();var o=A(x());b();p();var V=A(x()),at=()=>{let t=(0,V.useCallback)(s=>{if(!s)return!1;let e=s.getBoundingClientRect();if(e.width===0||e.height===0||e.top>=window.innerHeight||e.bottom<=0||e.left>=window.innerWidth||e.right<=0)return!1;let c=window.getComputedStyle(s);return!(c.display==="none"||c.visibility==="hidden"||parseFloat(c.opacity)===0)},[]),d=(0,V.useCallback)(s=>{if(!s)return!0;let e=s.getBoundingClientRect();if(e.top>=window.innerHeight||e.bottom<=0||e.left>=window.innerWidth||e.right<=0)return!0;let c=5,l=[];for(let f=0;f<c;f++)for(let a=0;a<c;a++){let n=e.left+e.width*(f+.5)/c,i=e.top+e.height*(a+.5)/c;n>=0&&n<=window.innerWidth&&i>=0&&i<=window.innerHeight&&l.push({x:n,y:i})}if(l.length===0)return!0;let h=0;for(let f of l){let a=document.elementFromPoint(f.x,f.y),n=!1,i=a;for(;i&&!n;){if(i===s){n=!0;break}if(i.shadowRoot&&Array.from(i.shadowRoot.querySelectorAll("*")).includes(s)){n=!0;break}i=i?.parentElement}!n&&a!==null&&h++}return h/l.length*100>50},[]);return{isElementVisible:t,isElementObscured:d}},et=at;var ut=t=>{let[d,s]=(0,o.useState)({anchorOffset:{x:0,y:8},lastValidPosition:void 0,obscured:!1,pointerPosition:"top-left",position:void 0,visible:!1}),[e,c]=(0,o.useState)(!0),[l,h]=(0,o.useState)(0),g=(0,o.useRef)(!1),f=(0,o.useRef)(!1),a=(0,o.useRef)(null),n=(0,o.useRef)(null),i=(0,o.useRef)(null),w=(0,o.useRef)(0),{isElementVisible:B,isElementObscured:L}=et(),I=(0,o.useCallback)(()=>{let r=document.querySelector(`[${v}]`),u=r?.shadowRoot?.querySelector(`[${v}]`)||null;return u?.querySelector("button")||u||r||null},[]),T=(0,o.useCallback)(()=>{let r=Date.now();if(i.current&&document.contains(i.current)&&r-w.current<1e4)return i.current;w.current=r;let y=I();return y&&(i.current=y),y},[I]),_=(0,o.useCallback)(()=>!!(document.querySelector(`[${v}]`)?.shadowRoot?.querySelector(`[${v}]`)||null),[]),N=(0,o.useCallback)(()=>{try{let r=T(),u=B(r),y=L(r),rt=_();if(g.current!==u||f.current!==y){let m=g.current;g.current=u,f.current=y,u&&!m&&h(P=>P+1)}if(r&&t&&u){let m=r.getBoundingClientRect(),P=window.innerWidth,C=m.left>P/2,F=C?{top:m.top,right:P-m.right}:{top:m.top,left:m.left},R=C?-23:-8;rt||(R=C?-23:0),j()&&(R=C?46:6),s(st=>({...st,anchorOffset:{x:R,y:m.height+10},lastValidPosition:F,obscured:y,pointerPosition:C?"top-right":"top-left",position:F,visible:u}))}else s(m=>({...m,anchorOffset:{x:0,y:8},obscured:y,pointerPosition:"top-left",position:m.lastValidPosition,visible:u}))}catch(r){console.error("Error updating anchor state:",r)}},[t,B,L,T,_]),O=(0,o.useCallback)(()=>{n.current&&(n.current.disconnect(),n.current=null);let r=new MutationObserver(()=>{let u=I();u&&(i.current=u,N(),r.disconnect(),n.current=null)});n.current=r,r.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:[v]})},[I,N]),E=(0,o.useCallback)(()=>{a.current&&(window.clearTimeout(a.current),a.current=null),e?(N(),c(!1)):a.current=window.setTimeout(()=>{N()},100)},[e,N]);return(0,o.useEffect)(()=>{(!d.visible||d.obscured)&&t&&!i.current&&O()},[d.visible,d.obscured,t,O]),(0,o.useEffect)(()=>{l>0&&(c(!0),E())},[l,E]),(0,o.useEffect)(()=>(T()||O(),E(),window.addEventListener("resize",E),window.addEventListener("scroll",E),()=>{window.removeEventListener("resize",E),window.removeEventListener("scroll",E),a.current&&window.clearTimeout(a.current),n.current&&(n.current.disconnect(),n.current=null)}),[E,T,O]),{anchorState:d,isInitialPlacement:e,resetPlacement:()=>c(!0),prevAnchorVisibleRef:g}},ot=ut;var dt=["individual-post-button-hint","introduce-ai-button"],ft=()=>{let{current:t,NotificationBoard:d}=tt({componentOnly:!0}),s=(0,S.useCallback)(w=>w!==void 0&&dt.includes(w),[]),[e,c]=(0,S.useState)(s(t?.id)),{anchorState:l,resetPlacement:h}=ot(e);(0,S.useEffect)(()=>{let w=s(t?.id);w!==e&&(c(w),h())},[t,e,s,h]);let g=l.position||l.lastValidPosition,f=e&&l.visible&&!l.obscured,a=document.querySelector("ytd-app")??document.body,{isDarkBackground:n}=Q(a),i=X(a);return preactH(H,{className:n||i?"dark ":" ",showPointer:!0,pointerPosition:l.pointerPosition,visible:f,position:g,anchorOffset:l.anchorOffset},preactH(Y,null,preactH(d,null)))},nt=ft;var it=({root:t,close:d})=>{let s=M(()=>$({key:"notifications-emotion-cache",container:t}),[t]),{current:e}=G(J);if(!e||!e.global&&!e.component){t.style.width="0vw";return}let c=q(()=>{K(e.id),t.style.width="0vw",d()},[e,t]);Z(t,c);let{id:l,render:h}=e;if(h)return e.global&&(t.style.width="100vw",e.allowPointerActions?t.style.pointerEvents="none":t.style.pointerEvents="unset"),preactH(z,{value:s},e.global&&h({id:l,dismiss:c}),preactH(nt,null))};var D;async function mt(){if(!D){let t=document.createElement("div");t.id="speechify-global-notifications",document.body.appendChild(t),D=t.attachShadow({mode:"open"})}try{let t=document.createElement("div");if(!t.style)throw new Error("Error creating div element");return t.id="speechify-global-notifications-root",t.style.cssText="position: fixed; top: 0; left: 0; height: 100vh; z-index: 2147483644;",D.appendChild(t),k(preactH(it,{root:t,close:()=>W("destroy",{},"feedback")}),t),()=>{k(()=>null,t),t.remove()}}catch(t){U(new Error(`Error creating div element: ${JSON.stringify(t,null,2)}`),{context:{from:"setupGlobalNotifications",site:window.location.href}})}}export{mt as default};
//# sourceMappingURL=init-FEDB5V55.js.map

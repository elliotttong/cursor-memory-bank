import{a as x}from"./chunk-MQX2TL35.js";import{a as U,b as K,c as W,e as $}from"./chunk-SWWFND36.js";import{$a as j,Ac as J,Ba as B,Fa as I,Mb as T,Wb as X,Xb as z,_a as f,g as v,h as D,i as Y,vc as Z,xc as l,yc as E,z as S,zc as Q}from"./chunk-6VFX2JNU.js";import{b as C,k as me,p as G,r as u,s as M,u as V,v as c,w as q,x as A}from"./chunk-LUKOAFYK.js";import{N as h,R as k,S as H}from"./chunk-O77QQVYU.js";import{d as L}from"./chunk-6HLOLWYC.js";import{a as R}from"./chunk-NORECDYR.js";import{d as ce,f as browser,h as s,o as a}from"./chunk-NUN3A7RC.js";a();s();var ne=ce(me());a();s();a();s();var ee=(e,t)=>{let i=({status:n,url:r})=>{r.includes(t)&&e(new Error(`Audio Server Error status code: ${n}`),{context:{url:r},type:"Audio Server"})};return k("failed",i),()=>H("failed",i)};a();s();var te=(e,t=[])=>{let i=({status:n,url:r})=>{if(t.some(y=>r.includes(y)))return;let w=n?`Http Request ${r} failed with status code: ${n}`:`Http Request ${r} failed without status code`;e(new Error(w),{context:{url:r},type:"Http Request"})};return h.on("failed",i),()=>h.off("failed",i)};var ie=()=>{let e=te(L,[R.audioServer.baseUrl]),t=ee(L,R.audioServer.baseUrl);return()=>{e(),t()}};var le=["pill-player","hover-player"],re={"anonymous-site-visit-logging":()=>import("./init-BP26EWIT.js"),"context-menus":()=>import("./init-6XAGDZWE.js"),"individual-posts-player":()=>import("./init-F27DTRWA.js"),"docs-support":()=>import("./init-X66K6JBL.js"),feedback:()=>import("./init-KWSWVLEL.js"),"gmail-support":()=>import("./init-6ONXCV4K.js"),"google-gen-ai-result":()=>import("./init-44ZT64ND.js"),"hover-player":()=>import("./init-ESVNB32Q.js"),"media-session":()=>import("./init-DSRJH353.js"),"paragraph-player":()=>import("./init-ESVNB32Q.js"),"player-actions":()=>import("./init-JOZH2AF7.js"),"pill-player":()=>import("./init-K23BFLL6.js"),"selection-player":()=>import("./init-R46EXWP7.js"),"sentence-player":()=>import("./init-BI4RLY4C.js"),"embedded-player":()=>import("./init-GFK7INQ3.js"),http:()=>import("./init-37XVZ5YI.js"),"screenshot-mode":()=>import("./init-LCCYJZVE.js"),notifications:()=>import("./init-FEDB5V55.js"),debugger:()=>import("./init-QU3EJ6BJ.js"),google:()=>import("./init-NNEJU3PF.js"),"google-drive-support":()=>import("./init-QIK7JZIN.js"),"track-listen-history":()=>import("./init-NHRMSNMI.js"),"history-notification":()=>import("./init-WPU7FI2N.js"),"kindle-support":()=>import("./init-PYEGSUIK.js"),"force-login":()=>import("./init-3F3YIAJJ.js"),"settings-sync":()=>import("./init-FY43W43J.js"),"shortcuts-prompt":()=>import("./init-BQQPFSUG.js"),"dyslexic-font-size":()=>import("./init-NBV2HIC4.js"),"canvas-notification":()=>import("./init-LQWHWGPL.js"),"standard-player":()=>import("./init-OVSBU72J.js"),"keypoint-extraction":()=>import("./init-OQBBM3IP.js"),"settings-modal":()=>import("./init-M7MEZQXY.js"),"paywall-modal":()=>import("./init-MZXEDCMU.js")};function ue(e){if(!Object.values(C).includes(e))throw new Error(`Unknown feature: "${e}" - the provided feature must be a FeaturesEnum value`);if(!re[e])throw new Error(`Unable to find init function for requested feature: "${e}"`);return re[e]}async function fe(){window.addEventListener("unhandledrejection",function(e){let t=e.reason;t&&c("error",{name:t.name,message:t.message,stack:t.stack,code:t.code,cause:t.cause})})}var m={};function oe(e,t){let i=(0,ne.merge)({},t.config.user,t.config.config);return Re((n,r)=>ue(e)().then(o=>o.default(i,n,r,t.config.featureflags)),t.lifecycles,e)}function Ee(e){Object.keys(m).forEach(t=>{m[t](),delete m[t]}),Object.keys(e).forEach(t=>{let i=e[t];i.status==="active"&&(m[t]=oe(t,i))})}var d=new Set;function pe(e,t){Object.keys(t).forEach(i=>{m[i]&&(m[i](),delete m[i]);let n=t[i];if(n&&n.status==="active"){m[i]=oe(i,n);let r=n.lifecycles;d.forEach(o=>{r.includes(o)&&c(o,{},i)})}})}async function g(){let[,e]=await Promise.all([I(),W()]),t=M(async r=>{d.has(r)||r!=="browser-action"&&d.add(r)},"orchestration-lifecycle-event-listener"),i=K(pe);he(),Ee(U()),await c("init"),await z.getIsPageReadable()&&await c("readable"),fe(),q();let n=ie();return()=>{d.clear(),t(),i(),e(),n()}}var O=()=>{};async function de(){Ie(),Se(),O=await g()}var b,Oe=[{domain:"wattpad.com",check:(e,t)=>{let i=parseInt(e.match(/[0-9]+/)?.[0]??""),n=parseInt(t.match(/[0-9]+/)?.[0]??"");return i===n}},{domain:"mail.google.com",check:(e,t)=>{let i=new URL(e),r=new URL(t).hash.split(/\/|\?/)[1]??"";return(i.hash.split(/\/|\?/)[1]??"")===r}},{domain:"x.com",check:(e,t)=>t.includes("/compose/post")||e.includes("/compose/post")}],P=!1;B(async(e,t)=>{if(e===t||Z())return;let i=!!j.getBundleState().bundle;(l(e,t,"chat.deepseek.com")||l(e,t,"www.perplexity.ai")||l(e,t,"www.perplexity.ai","/search/new"))&&i||l(e,t,"chat.openai.com")||l(e,t,"chatgpt.com")||((E(e,t,"chat.openai.com")||E(e,t,"chatgpt.com")||E(e,t,"chat.deepseek.com"))&&i&&(P=!0),Q(e,t))||Oe.some(r=>window.location.href.includes(r.domain)&&r.check(e??"",t??""))||(b&&(clearTimeout(b),cancelAnimationFrame(b)),ye())});var p=!1;function ye(){p||(p=!0,c("destroy"),X(),V(),O(),P?(g(),O=()=>{},p=!1):setTimeout(async()=>{O=await g(),p=!1},250),P=!1)}function Re(e,t,i){let n=!1,r,o=new AbortController,y=A(async(N,ae)=>{if(n){N==="browser-action"&&(typeof r=="function"&&r(),r=void 0,n=!1,o.abort(),o=new AbortController);return}n=!0;let F=await e(N,ae,o.signal);!F&&le.includes(i)?n=!1:r=F},t,i),_=async()=>{typeof r=="function"&&await Promise.resolve(r()),r=void 0,n=!1},se=A(_,["destroy"],i);return async()=>{o.abort(),y(),se(),await _()}}async function Le(){let e=G();x()?S.forceManageInitPillPlayer(!e):e||(await S.toggleFeatureOnDomain("pill-player",!0),await $())}function Se(){T("/browser-action",async()=>{await Le(),J("extension_browser_action_clicked",{}),await c("browser-action",{isFromExtensionIconClick:!0}),(window.getSelection()?.toString()??"").length>0&&f.play()}),T("/health-check",async(e,t)=>{t.body.healthCheck=!0})}function he(){let e=async()=>{v.invalidateCache(),D().then(Y)};u("browser-action",e,"subscription"),u("audio-loading",e,"subscription"),u("destroy",async()=>{f.pause(),f.resetState()},"playback")}async function Ie(){await I();let e=document.createElement("div");e.style.fontFamily="ABCDiatype",e.style.visibility="hidden",e.innerHTML="asd",document.body.appendChild(e),setTimeout(()=>e?.remove(),0)}var Ae=()=>{browser.runtime.connect().onDisconnect.addListener(async()=>{setTimeout(()=>{!!browser.runtime?.id||c("destroy")},1e3)})};de();Ae();export{ye as a};
//# sourceMappingURL=chunk-437XFN2F.js.map

chrome.pe=new function(){let e=this;e.getPeListForUser=function(e=!1,s=null){var i;e&&s&&(i=s.id,chrome.cognitoUser?chrome.cognitoUser.getSession((function(e,s){if(s){const e={Authorization:s.idToken.jwtToken,"Content-Type":"application/json"},o=new URLSearchParams({userId:i});return fetch(t+"?"+o,{method:"GET",mode:"cors",cache:"no-cache",headers:e,referrer:"client",referrerPolicy:"origin-when-cross-origin"}).then((e=>e.json())).then((e=>e.pe?a(n(e.pe)):a([]))).catch((e=>a([])))}console.error("pe getSession error",e)})):a([]))},e.setPeAndTts=a,e.getPeLastUpdated=function(t,n,s){s(e.lastUpdated)},e.getLastestPe=function(t,n,s){s({peList:e.peList,peMap:e.peMap,lastUpdated:e.lastUpdated})},e.getPeListAndMap=function(t,n,s){s({peList:e.peList,peMap:e.peMap})},e.isAsyncFunction=function(t){return e.asyncFunctions.includes(t)},e.peList=[],e.peMap=new Map,e.asyncFunctions=[],e.lastUpdated=null,e.isInit=!1;const t="https://sgglax06i9.execute-api.us-east-1.amazonaws.com/prod/pe";function n(e){return e?e.map(s.bind(this)):[]}function s(e){let t=function(e){const t=/[\*\.\?\+\$\^\[\]\(\)\{\}\|\\\/\:\<\>\=\-]/g,n=/[^ -~]/g;let s=e,i=!1;return(t.test(e)||n.test(e))&&(i=!0,s=e.replace(t,(function(e){return"\\"+e}))),{hasSpecialChars:i,processedText:s}}(e.source),n={hasSpecialChars:!1,processedText:e.replace};return{...e,processedSource:e.source,processedReplace:n.processedText,hasSpecialChars:t.hasSpecialChars||n.hasSpecialChars,ignoreWordBoundary:e.ignoreWordBoundary,matchCase:e.matchCase}}function i(e){a(n(e.peList))}function a(t){if(t&&t.length>0){e.peList=t,e.peMap=e.peList.reduce(((e,t)=>(e.set(t.source,t.replace),e)),new Map),chrome.storage.sync.set({peList:e.peList}),e.lastUpdated=Date.now();const n=extension.beingReadTabId?extension.beingReadTabId:extension.activeTabId?extension.activeTabId:null;null!=n&&chrome.tabs.sendMessage(n,{fn:"setPeAndTts",peList:e.peList,lastUpdated:e.lastUpdated},(()=>{chrome.runtime.lastError}))}}!function(){e.isInit||(chromeRuntimeMsgExternal.setFilter("setPeData",i.bind(this)),chrome.runtime.onMessage.addListener((function(t,n,s){if(e[t.fn]&&(e[t.fn](t,n,s),e.isAsyncFunction(t.fn)))return!0})),chrome.storage.sync.get("peList").then((e=>{e&&e.peList&&e.peList.length>0&&a(e.peList)}))),e.isInit=!0}()};
function NRExtReadingBar(){let e=this;e.capsule=null,e.shadow=null,e.prevPos={top:null,right:null},displace=window.displacejs,e.hasReadingBar=!1,e.isVoicesInit=!1,e.isClonedVoicesPopulated=!1,e.theme="light",e.systemTheme="light",e.isAutoSelectVoice=!1,e.isImmersive=!1,e.isImmersiveTextSpacing=!1,e.immersiveTextSize=1,e.isInjectingReadingBar=!1,e.showOnboard=!1,e.isSavingToMobile=!1,e.isAsyncFunction=function(t){return e.asyncFunctions.includes(t)},e.asyncFunctions=["getHasTextProcessor","getHasReadingBar","injectReadingBar"],e.getHasTextProcessor=function(e,t,n){try{return void 0===nrTextProcessor?n(!1):n(!0),!0}catch(e){return n(!1),!0}},e.getHasReadingBar=function(t,n,i){i(e.hasReadingBar)},e.injectReadingBar=Ce,e.setReadingBarSetting=O,e.updateReadingBarSetting=function(t,n,i){e.settings=t.settings},e.setReadingBarVisibility=Se,e.setReadingBarUI=a,e.setUIVoiceList=I,e.toggleReadingBar=Ie,e.voicesOnLoad=function(t,n,i){e.settings.freeVoice=e.settings.freeVoice?e.settings.freeVoice:voices.defaultFreeVoice,e.settings.premVoice=e.settings.premVoice?e.settings.premVoice:voices.defaultPremVoice,e.settings.plusVoice=e.settings.plusVoice?e.settings.plusVoice:voices.defaultPlusVoice,e.settings.preset1Voice=e.settings.preset1Voice?e.settings.preset1Voice:voices.defaultPremVoice,e.settings.preset2Voice=e.settings.preset2Voice?e.settings.preset2Voice:voices.defaultPremVoice,e.settings.preferredVoicesByLang=0===Object.keys(e.settings.preferredVoicesByLang).length?voices.preferredVoicesByLang:e.settings.preferredVoicesByLang,voices.preferredVoicesByLang=e.settings.preferredVoicesByLang,e.isVoicesInit||m()},e.updateVoice=h,e.updateClonedVoiceList=function(){let t=voices.getVoice(e.settings.selectedVoice);t&&("Cloned"===t.languageName||"Cloned"===e.languageList.value?(e.languageList.value="Cloned",I(voices.allVoicesMap.get("Cloned")),T()):(t=voices.getVoice(e.settings.selectedVoice),e.languageList.value=t.languageName,I(voices.allVoicesMap.get(t.languageName))))},e.getReadingBarElements=function(){return readingBarElements},e.setPresetAsSelectedVoice=function(t,n,i){const s=t.index;O("selectedVoice",e.settings["preset"+s+"Voice"]),h()},e.setToggle=ue,e.setDyslexia=ce,e.updateNumPages=function(){e.isInjectingReadingBar||(e.immersiveTotalPages.innerText=doc.getNumPages(),Ye())},e.toggleImmersive=_e,e.setImmersiveTexts=function(){if(Je(),"googleDoc"==doc.type||"googleDrivePreview"==doc.type||!doc.parseForConvertToPdf)return Promise.resolve().then((()=>{if("googleDoc"!=doc.type)return function(){const t=nrTextProcessor.textsToRead,n=doc.getCurrentIndex();for(let i=0;i<t.length;i++){sentenceId="nr-immersive-s"+i;const s=document.createElement("P"),o=document.createElement("nr-sentence"),r=document.createTextNode(t[i]);o.classList.add(sentenceId),o.id=sentenceId,o.setAttribute("page",n),o.appendChild(r),s.appendChild(o),nrDomController.bindClickToReadEventsForImmersiveReader(o),e.immersiveTextContainer.appendChild(s)}}();doc.parsePageForImmersiveReader().then((function(e){return Ke(e)}))})).then((()=>{Ze(),e.immersiveTotalPages.innerText=doc.getNumPages(),e.immersiveCurrentPageInput.value=doc.getPageIndex(),e.immersivePrevPageButton.style.display="block",e.immersiveNextPageButton.style.display="block",Ye()})).catch((e=>{}));doc.parseForConvertToPdf().then((function(e){return Ke(e)})).then((()=>{Ze(),e.immersivePrevPageButton.style.display="block",e.immersiveNextPageButton.style.display="block",Ye()})).catch((e=>{}))},e.setImmersiveNotReadTextClass=de,e.showRelocateButton=function(){"googleDrivePreview"!==doc.type&&"selection-context-menu"!=reader.readOption&&(e.relocateBtn.style.display="block")},e.hideRelocateButton=ae,e.readSelection=ne,e.setCCText=je,e.toggleCC=pe,e.initTooltip=function(t,n,i){const s=e.shadow.getElementById(t.id+"Tooltip");if(s)return void(s.style.display="none");let o=function(e,t,n){let i=document.createElement("span");n.length>20&&i.classList.add("tooltip");return i.id=e.id+"Tooltip",i.classList.add(t+"Tooltip"),i.style.display="none",i.innerHTML=n,e.appendChild(i),i}(t,n,i);t.onmouseenter=function(){"nr-ext-btn-relocate"!==t.id&&(o.style.display="block")},t.onmouseleave=function(){o.style.display="none"},o.onmouseenter=function(){o.style.display="none"}},e.readBtnOnClick=J,e.setUIOnLoading=xe,e.setUIOnPause=be,e.setUIOnPlay=Te,e.readerOnPlay=function(){Te(),function(t=0,n=!0){if(e.progressTimeLabel.innerText=e.indexToProgressTime[t]?e.indexToProgressTime[t].displayedTime:"0:00",n){const n=360*(e.indexToProgressTime[t].seconds/e.indexToProgressTime[Object.keys(e.indexToProgressTime).length-1].seconds);e.progressSlider.style.background=`conic-gradient(#E5F1FF ${n}deg, #0078D4 0deg)`}}(reader.currReadIndex,!0),function(t){if(!e.indexToProgressTime[t]||!e.indexToProgressTime[t+1])return;const n=e.indexToProgressTime[t].seconds;e.indexToProgressTime[t+1].seconds;let i=n;e.progressTimeIncrementor&&(clearInterval(e.progressTimeIncrementor),e.progressTimeIncrementor=null);e.progressTimeIncrementor=setInterval((()=>{i++,e.progressTimeLabel.innerText=qe(i)}),1e3)}(reader.currReadIndex),("kindle"===doc.type||"googleDoc"===doc.type)&&(je(ttsText.textsForTts[reader.currReadIndex].processed,reader.currReadIndex),e.isCC?pe(!0):pe(!1))},e.readerOnPause=Le,e.readerOnLoading=Be,e.readerOnStop=function(){ke()},e.textsToReadOnChange=function(){Oe(ttsText.textsForTts)},e.changeDisplay=X,e.defaultEmail="user@naturalreaders.com",e.freeUserText="Free User",e.premUserText="Premium User",e.plusUserText="Plus User",e.eduPremUserText="Edu Premium Group User",e.freeEduPremUserText="Free Edu Premium Group User",e.eduPremUserExpiredText="Edu Premium Group User (Expired)",e.loadingTimer=null,e.voiceType="prem",e.progressTimeIncrementor=null,e.isBeingDragged=!1,e.inactivityTimeout=null,e.messageType="signup",e.messageTime=null,e.messageFirstDay=null,e.rateMessageTime=null,e.isShowMobileMessage=!0,e.isShowRateMessage=!0,e.isShowSignupMessage=!0,e.messageIndex=0,e.isPlayPauseHotkey=!0,e.isPrevHotkey=!0,e.isNextHotkey=!0,e.hideMessage=l,e.hideRelocateButton=ae,e.showMessageBar=function(t=""){d(),X("msgBar",!0),X("msgBox",!1),G(e.msgBar,"msg-type",t)},e.hideIrrelevantPopups=d;let t={ext:"nr-ext",container:"nr-ext-container",controls:"nr-ext-controls",exitBtn:"nr-ext-exit",dragHandle:"nr-ext-drag",readBtn:"nr-ext-play",forwardBtn:"nr-ext-forward",backwardBtn:"nr-ext-rewind",clickToReadToggle:"nr-ext-click-to-read-toggle",peBtn:"nr-ext-pe",helpBtn:"nr-ext-settings-help",convertBtn:"nr-ext-mp3",ccToggle:"nr-ext-cc-toggle",autoScrollToggle:"nr-ext-autoscroll-toggle",loginBtn:"nr-ext-account-login",logoutBtn:"nr-ext-account-logout",signupBtn:"nr-ext-account-signup",billingBtn:"nr-ext-account-billing",emailUI:"nr-ext-account-info",loginUI:"nr-ext-account-actions",userEmail:"nr-ext-account-email",onboard:"nr-ext-onboard",onboardLogin:"nr-ext-onboard-login",onboardSignup:"nr-ext-onboard-signup",onboardLanguageList:"nr_ext_onboard_languages",onboardVoicePrevBtn:"nr-ext-onboard-voice-prev",onboardVoiceNextBtn:"nr-ext-onboard-voice-next",onboardVoiceList:"nr-ext-onboard-voice-list",voiceMenuBtn:"nr-ext-voices-trigger",voiceMenu:"nr-ext-voices",voiceMenuCloseBtn:"nr-ext-voices-close",voiceSearchBtn:"nr-ext-voice-search",voiceSearchClose:"nr-ext-voice-search-close",voiceSearchInput:"nr-ext-input-search",voiceActions:"nr-ext-voice-actions",voiceChips:"nr-ext-voices-chips",voiceList:"nr-ext-voice-list",voiceListLoading:"nr-ext-voice-loading",communityVoiceFilter:"nr-ext-community-voice-filter",communityVoiceRefresh:"nr-ext-community-voice-refresh",communityVoiceFilterMenu:"nr-ext-community-voice-filter-menu",communityVoiceFilterButtons:"nr-ext-community-voice-filter-buttons",communityVoiceFilterOptions:"nr-ext-community-voice-filter-options",communityVoiceFilterSort:"nr-ext-community-voice-filter-sort",communityVoiceFilterGender:"nr-ext-community-voice-filter-gender",communityVoiceFilterTags:"nr-ext-community-voice-filter-tags",communityVoiceFilterLocales:"nr-ext-community-voice-filter-locales",communityVoiceResetFilter:"nr-ext-community-voice-filter-reset",voiceListMapper:"nr-ext-voice-list-mapper",languageList:"nr-ext-language",voiceIcon:"nr-ext-voices-icon",voiceIconCloned:"nr-ext-voices-icon-cloned",voiceTogglingTrigger:"nr-ext-voice-toggling-trigger",voiceTogglingBack:"nr-ext-voice-toggling-back",voiceTogglingClose:"nr-ext-voice-toggling-close",preset1VoiceList:"nr-ext-preset1-voice",preset2VoiceList:"nr-ext-preset2-voice",readIcon:"nr-ext-read-icon-toggle",highlightTypeMenu:"nr-ext-highlight-type-menu",highlightColourMenu:"nr-ext-highlight-color-menu",highlightPreview:"nr-ext-highlight-preview",autoSelectVoiceToggle:"nr-ext-auto-select-voice",resetBtn:"nr-ext-reset",selectableCharLimit:"nr-ext-rs-char-limit",hotkeysBtn:"nr-ext-hotkey-trigger",hotkeyClose:"nr-ext-hotkeys-close",hotkeyBack:"nr-ext-hotkeys-back",hotkeyEditBtn:"nr-ext-settings-hotkey",hotkeyActivateText:"nr-ext-hotkey-activate-text",playPauseHotkeyToggle:"nr-ext-playpause-hotkey-toggle",playPauseHotkeyText:"nr-ext-playpause-hotkey-text",prevHotkeyToggle:"nr-ext-prev-hotkey-toggle",nextHotkeyToggle:"nr-ext-next-hotkey-toggle",speedTrigger:"nr-ext-speed-trigger",speedTriggerText:"nr-ext-speed-trigger-text",speedClose:"nr-ext-speed-close",speedSlider:"nr-ext-speed-slider",speedText:"nr-ext-speed-text",speedFactorText:"nr-ext-speed-factor-text",speedSubBtn:"nr-ext-speed-sub",speedAddBtn:"nr-ext-speed-add",volumeTrigger:"nr-ext-volume-trigger",volumeMenu:"nr-ext-volume",volumeSlider:"nr-ext-volume-slider",volumeText:"nr-ext-volume-text",volumeSubBtn:"nr-ext-volume-sub",volumeAddBtn:"nr-ext-volume-add",ccContainer:"nr-ext-cc",closeCC:"btn-close-cc",ccText:"nr-ext-cc-text",progressTimeLabel:"nr-ext-progress-label",progressSlider:"nr-ext-progress-bar",progressContainer:"nr-ext-progress",feedbackBtn:"nr-ext-settings-feedback",uploadBtn:"nr-ext-pdf",convertToPdfAgainBtn:"nr-ext-btn-convert-to-pdf-again",saveToMobileBtn:"nr-ext-save-to-mobile",mobileLoginBtn:"nr-ext-mobile-login",saveToMobileInit:"nr-ext-mobile-init",saveToMobileSaving:"nr-ext-mobile-saving",saveToMobileFinish:"nr-ext-mobile-finish",saveToMobileErrorMsg:"nr-ext-mobile-error",subMenuTrigger:"nr-ext-subTrigger",settingsBtn:"nr-ext-settings-trigger",settingsCloseBtn:"nr-ext-settings-close",settingsAccountBtn:"nr-ext-account-trigger",accountClose:"nr-ext-account-close",accountBack:"nr-ext-account-back",mobileTrigger:"nr-ext-save-to-mobile-trigger",mobileClose:"nr-ext-mobile-close",themeTrigger:"nr-ext-theme-trigger",themeClose:"nr-ext-theme-close",themeBack:"nr-ext-theme-back",themeSelect:"nr-ext-theme-select",highlightTrigger:"nr-ext-highlight-trigger",highlightClose:"nr-ext-read-option-close",highlightBack:"nr-ext-read-option-back",otherTrigger:"nr-ext-more-trigger",otherClose:"nr-ext-other-close",otherBack:"nr-ext-other-back",quickSettings:"nr-ext-quick-trigger",quickClose:"nr-ext-start-option-close",quickBack:"nr-ext-start-option-back",immersiveBtn:"nr-ext-immersive-toggle",quickStartToggle:"nr-ext-quick-start-toggle",quickStartWebpageCheckbox:"nr-ext-quick-start-webpages",quickStartPdfCheckbox:"nr-ext-quick-start-pdf",quickStartGoogleDocsCheckbox:"nr-ext-quick-start-googledocs",quickStartEmailCheckbox:"nr-ext-quick-start-email",quickStartWebsiteCheckbox:"nr-ext-quick-start-website",quickStartOptions:"nr-ext-quick-start-group",relocateBtn:"nr-ext-btn-relocate",immersiveReader:"nr-ext-immersive-reader",immersiveTextSettingsButton:"nr-ext-immersive-trigger",immersiveCloseBtn:"nr-ext-immersive-close",immersiveTextSpacingToggle:"nr-ext-immersive-toggle-text-spacing",immersiveTextSizeSlider:"nr-ext-immersive-textsize",immersiveTextContainer:"nr-ext-immersive-text-container",immersiveTextContent:"nr-ext-immersive-text",immersiveTextSettingsMenu:"nr-ext-immersive-menu",immersiveDyslexiaToggle:"nr-ext-immersive-toggle-dyslexia",immersiveBlurTextToggle:"nr-ext-immersive-toggle-toggle-blur-text",immersiveNextPageButton:"nr-ext-immersive-next-page",immersivePrevPageButton:"nr-ext-immersive-prev-page",immersiveTotalPages:"nr-ext-immersive-all-page",immersivePagesToolbar:"nr-ext-immersive-reader-pages",immersiveCurrentPageInput:"nr-ext-immersive-current-page",msgBar:"nr-ext-msg-bar",msgBox:"nr-ext-msg-box",voiceReactivatingBar:"nr-ext-voice-reactivating-bar",loginRequiredBar:"nr-ext-login-required",loginRequiredClose:"nr-ext-login-required-close",mobileMsgOffCheckbox:"ext-msg-hide",msgAndroidButton:"nr-ext-msg-android",msgIosButton:"nr-ext-msg-ios",msgMobileDownload:"nr-ext-msg-download-mobile",msgRateNo:"nr-ext-rate-no",msgRateYes:"nr-ext-rate-yes",msgLeaveReviewButton:"nr-ext-msg-leave-review",freevoicePopup:"nr-ext-use-freevoice",versionNumberLbl:"nr-ext-version"},n={both:{key:"both",value:["sentence","word"],text:"Sentence and word"},sentence:{key:"sentence",value:["sentence"],text:"Sentence only"},word:{key:"word",value:["word"],text:"Word only"},none:{key:"none",value:[],text:"None"}};e.indexToProgressTime={},e.isAutoScroll=!0,e.isDyslexic=!1,e.isClickToRead=!0,e.isCC=!1,e.isCCVisible=!1,e.isQuickStartWebpage=!0,e.isQuickStartPdf=!0,e.isQuickStartGoogleDocs=!0,e.isQuickStartEmail=!0,e.isQuickStartThisWebsite=!0,e.isReadIcon=!0;e.uploadPdfUrl="",e.settings={};const i='@font-face {\n        font-family: "opendyslexic";\n        src: url(chrome-extension://kohfgcgbkjodfcfkcackpagifgbcmimk/assets/css/open-dyslexic/OpenDyslexic-Regular.otf);\n        font-style: normal;\n        font-weight: normal;\n        font-display: fallback;\n      }\n      @font-face {\n        font-family: "opendyslexic";\n        src: url(chrome-extension://kohfgcgbkjodfcfkcackpagifgbcmimk/assets/css/open-dyslexic/OpenDyslexic-Italic.otf);\n        font-style: italic;\n        font-weight: normal;\n        font-display: fallback;\n      }\n      @font-face {\n        font-family: "opendyslexic";\n        src: url(chrome-extension://kohfgcgbkjodfcfkcackpagifgbcmimk/assets/css/open-dyslexic/OpenDyslexic-Bold.otf);\n        font-weight: bold;\n        font-style: normal;\n        font-display: fallback;\n      }\n      @font-face {\n        font-family: "opendyslexic";\n        src: url(chrome-extension://kohfgcgbkjodfcfkcackpagifgbcmimk/assets/css/open-dyslexic/OpenDyslexic-BoldItalic.otf);\n        font-weight: bold;\n        font-style: italic;\n        font-display: fallback;\n      }',s='\n    @font-face {\n        font-family: "Poppins";\n        font-weight: 300;\n        font-style: normal;\n        src: url(chrome-extension://kohfgcgbkjodfcfkcackpagifgbcmimk/assets/css/poppins/Poppins-Light.ttf);\n        font-display: swap;\n        }\n    @font-face {\n        font-family: "Poppins";\n        font-weight: 300;\n        font-style: italic;\n        src: url(chrome-extension://kohfgcgbkjodfcfkcackpagifgbcmimk/assets/css/poppins/Poppins-LightItalic.ttf);\n        font-display: swap;\n    }\n    @font-face {\n        font-family: "Poppins";\n        font-weight: 400;\n        font-style: normal;\n        src: url(chrome-extension://kohfgcgbkjodfcfkcackpagifgbcmimk/assets/css/poppins/Poppins-Regular.ttf);\n        font-display: swap;   \n    }\n    @font-face {\n        font-family: "Poppins";\n        font-weight: 400;\n        font-style: italic;\n        src: url(chrome-extension://kohfgcgbkjodfcfkcackpagifgbcmimk/assets/css/poppins/Poppins-Italic.ttf);\n        font-display: swap;   \n    }\n    @font-face {\n        font-family: "Poppins";\n        font-weight: 500;\n        font-style: normal;\n        src: url(chrome-extension://kohfgcgbkjodfcfkcackpagifgbcmimk/assets/css/poppins/Poppins-Medium.ttf);\n        font-display: swap;    \n    }\n    @font-face {\n        font-family: "Poppins";\n        font-weight: 500;\n        font-style: italic;\n        src: url(chrome-extension://kohfgcgbkjodfcfkcackpagifgbcmimk/assets/css/poppins/Poppins-MediumItalic.ttf);\n        font-display: swap;    \n    }\n    @font-face {\n        font-family: "Poppins";\n        font-weight: 600;\n        font-style: normal;\n        src: url(chrome-extension://kohfgcgbkjodfcfkcackpagifgbcmimk/assets/css/poppins/Poppins-SemiBold.ttf);\n        font-display: swap;    \n    }\n    @font-face {\n        font-family: "Poppins";\n        font-weight: 600;\n        font-style: italic;\n        src: url(chrome-extension://kohfgcgbkjodfcfkcackpagifgbcmimk/assets/css/poppins/Poppins-SemiBoldItalic.ttf);\n        font-display: swap;    \n    }\n    @font-face {\n        font-family: "Poppins";\n        font-weight: 700;\n        font-style: normal;\n        src: url(chrome-extension://kohfgcgbkjodfcfkcackpagifgbcmimk/assets/css/poppins/Poppins-Bold.ttf);\n        font-display: swap;   \n    }\n    @font-face {\n        font-family: "Poppins";\n        font-weight: 700;\n        font-style: italic;\n        src: url(chrome-extension://kohfgcgbkjodfcfkcackpagifgbcmimk/assets/css/poppins/Poppins-BoldItalic.ttf);\n        font-display: swap;    \n    }   \n    ';async function o(){try{await new Promise((n=>{for(let n in t)e[n]=e.shadow.getElementById(t[n]);n()})).catch((e=>{})),await new Promise((t=>{const n={constrain:!1,handle:e.dragHandle,onMouseDown:Q,onMouseUp:_,customMove:W};function i(){let t=e.settings.speed-5;t>=50&&(Re(t),O("speed",t))}function s(){let t=e.settings.speed+5;t<=540&&(Re(t),O("speed",t))}function o(t){O("speed",parseInt(t)),De(e.settings.speed),Oe(ttsText.textsForTts)}displace(e.container,n),e.container.style.position="fixed",e.subMenuTrigger.onclick=j,e.controls.addEventListener("mouseenter",(function(){e.controls.classList.remove("nr-ext-mouseleave")})),e.controls.addEventListener("mouseleave",(function(){e.controls.querySelector(".nr-ext-max").classList.contains("show-sub")?e.controls.classList.remove("nr-ext-mouseleave"):e.controls.classList.add("nr-ext-mouseleave")})),e.exitBtn.onclick=()=>{reader.stop(),Ie()},e.readBtn.onclick=J,e.forwardBtn.onclick=reader.forward,e.backwardBtn.onclick=reader.backward,e.voiceMenuCloseBtn.onclick=function(){Y("init")},e.voiceMenuBtn.onclick=function(){Y("voices")},e.voiceSearchBtn.onclick=function(){e.voiceActions.classList.add("ext-searching"),e.voiceSearchInput.focus()},e.communityVoiceFilter.onclick=function(){X("communityVoiceFilterMenu",!0),X("communityVoiceFilterButtons",!0),X("communityVoiceFilterOptions",!1)},e.communityVoiceRefresh.onclick=y,e.communityVoiceFilterSort.onclick=function(){k("sort")},e.communityVoiceFilterGender.onclick=function(){k("gender")},e.communityVoiceFilterTags.onclick=function(){k("tags")},e.communityVoiceFilterLocales.onclick=function(){k("locales")},e.communityVoiceResetFilter.onclick=function(){C(),b(),X("communityVoiceFilterMenu",!1)},e.voiceSearchClose.onclick=function(){if(e.voiceSearchInput.value="",e.voiceActions.classList.remove("ext-searching"),"Community"==e.languageList.value)f(e.languageList.value);else{let t=voices.getVoice(e.settings.selectedVoice).languageName;e.languageList.value=t,O("voiceLanguage",""),I(voices.allVoicesMap.get(t))}},e.settingsBtn.onclick=()=>{Y("settings")},e.settingsCloseBtn.onclick=()=>{z("init")},e.hotkeysBtn.onclick=()=>{Y("hotkeys")},e.hotkeyClose.onclick=()=>{Y("init")},e.hotkeyBack.onclick=()=>{Y("settings")},e.hotkeyEditBtn.onclick=()=>{chrome.runtime.sendMessage({fn:"editHotkeys"},(()=>{chrome.runtime.lastError}))},e.settingsAccountBtn.onclick=()=>{Y("account")},e.accountClose.onclick=()=>{!function(t){const n=e.container.getAttribute("menu-status");"account"==t?"account"==n?e.container.setAttribute("menu-status","settings"):e.container.setAttribute("menu-status","account"):e.container.setAttribute("menu-status","settings")}("init")},e.accountBack.onclick=()=>{z("settings")},e.mobileTrigger.onclick=()=>{Y("mobile"),"mobile"===e.container.getAttribute("menu-status")&&Pe("init")},e.mobileClose.onclick=()=>{Y("init")},e.otherTrigger.onclick=()=>{Y("others")},e.otherClose.onclick=()=>{Y("init")},e.otherBack.onclick=()=>{Y("settings")},e.themeTrigger.onclick=()=>{Y("theme")},e.themeClose.onclick=()=>{Y("init")},e.themeBack.onclick=()=>{Y("settings")},e.highlightTrigger.onclick=()=>{Y("read-option")},e.highlightClose.onclick=()=>{Y("init")},e.highlightBack.onclick=()=>{d(),Y("settings")},e.quickSettings.onclick=()=>{Y("quick-start-option")},e.quickClose.onclick=()=>{Y("init")},e.quickBack.onclick=()=>{Y("others")},e.voiceTogglingTrigger.onclick=()=>{Y("toggle-voices")},e.voiceTogglingBack.onclick=()=>{Y("others")},e.voiceTogglingClose.onclick=()=>{Y("init")},e.volumeTrigger.onclick=()=>{!function(){const t=e.volumeTrigger.querySelector("use"),n=e.volumeTrigger.querySelector("svg");"none"===e.volumeMenu.style.display||""===e.volumeMenu.style.display?(e.volumeMenu.style.display="flex",t.setAttribute("xlink:href","#ext_arrow_down"),n.classList.remove("icon-arrow-right")):(e.volumeMenu.style.display="none",t.setAttribute("xlink:href","#ext_arrow_back"),n.classList.add("icon-arrow-right"))}()},e.speedTrigger.onclick=()=>{Y("speed")},e.speedClose.onclick=()=>{Y("init")},e.highlightColourMenu.onchange=()=>{A(e.highlightColourMenu.value,e.settings.highlightColour)},e.highlightTypeMenu.onchange=()=>{E(e.highlightTypeMenu.value)},e.immersiveBtn.onclick=()=>{_e()},e.quickStartToggle.onclick=t=>{e.quickStartToggle.checked?(ve("webpage",!0),ve("googleDocs",!0),ve("email",!0),ve("pdf",!0),ve("website",!0)):(ve("webpage",!1),ve("googleDocs",!1),ve("email",!1),ve("pdf",!1),ve("website",!1)),he()},e.quickStartWebpageCheckbox.onclick=()=>{ve("webpage",!e.isQuickStartWebpage,!0)},e.quickStartPdfCheckbox.onclick=()=>{ve("pdf",!e.isQuickStartPdf,!0)},e.quickStartGoogleDocsCheckbox.onclick=()=>{ve("googleDocs",!e.isQuickStartGoogleDocs,!0)},e.quickStartEmailCheckbox.onclick=()=>{ve("email",!e.isQuickStartEmail,!0)},e.quickStartWebsiteCheckbox.onclick=()=>{ve("website",!e.isQuickStartThisWebsite,!0)},e.selectableCharLimit.onchange=t=>{u(parseInt(e.selectableCharLimit.value))},e.speedSubBtn.onclick=()=>{i()},e.speedAddBtn.onclick=()=>{s()},e.speedSlider.addEventListener("input",(()=>{De(parseInt(e.speedSlider.value))})),e.speedSlider.addEventListener("change",(()=>{o(parseInt(e.speedSlider.value))})),e.volumeSlider.addEventListener("change",(t=>{O("volume",Math.round(100*parseFloat(e.volumeSlider.value))/100)})),e.volumeSlider.addEventListener("input",(t=>{Fe(Math.round(100*parseFloat(e.volumeSlider.value))/100)})),e.volumeSubBtn.onclick=()=>{let t=e.settings.volume-.01;t>=0&&Ne(t)},e.volumeAddBtn.onclick=()=>{let t=e.settings.volume+.01;t<=1&&Ne(t)},e.autoSelectVoiceToggle.onclick=()=>{fe(!e.isAutoSelectVoice)},e.clickToReadToggle.onclick=()=>{ge(!e.isClickToRead)},e.readIcon.onclick=()=>{ye(!e.isReadIcon)},e.ccToggle.onclick=()=>{me(!e.isCC)},e.peBtn.onclick=Z,e.playPauseHotkeyToggle.onclick=()=>{se(!e.isPlayPauseHotkey)},e.prevHotkeyToggle.onclick=()=>{oe(!e.isPrevHotkey)},e.nextHotkeyToggle.onclick=()=>{re(!e.isNextHotkey)},e.autoScrollToggle.onclick=()=>{ie(!e.isAutoScroll,!0)},e.closeCC.onclick=()=>{me(!1)},e.helpBtn.onclick=()=>{window.open("https://help.naturalreaders.com/en/collections/785014-naturalreader-online-chrome-extension","_blank")},e.uploadBtn.onclick=()=>{chrome.runtime.sendMessage({fn:"showUploadPage"},(()=>{chrome.runtime.lastError}))},e.convertBtn.onclick=()=>{nrTextProcessor.getTextsFromPage("convert").then((function(e){if(e&&0===e.length)throw new Error("ERR_NO_TEXT");{const t=new Blob([e.join("\n")],{type:"text/plain"}),n=window.URL.createObjectURL(t);chrome.runtime.sendMessage({fn:"setFile",url:n,fileName:"ext-file.txt"},(()=>{chrome.runtime.lastError}))}})).catch((function(e){return e&&e.message?chrome.runtime.sendMessage({fn:"displayAlertMessage",message:e.message}):chrome.runtime.sendMessage({fn:"displayAlertMessage",message:new Error("ERR_UNKNOWN")})}))},e.loginBtn.onclick=q,e.mobileLoginBtn.onclick=q,e.logoutBtn.onclick=H,e.billingBtn.onclick=ee,e.onboardLogin.onclick=()=>{et(!1),q()},e.signupBtn.onclick=U,e.onboardSignup.onclick=()=>{et(!1),U()},e.feedbackBtn.onclick=()=>{!function(){const t=reader.docType;let n="N/A";e.settings.loggedIn&&(n=e.settings.userInfo.email);let i={docType:t,texts:ttsText.textsForTts.map((e=>e.original)).join(""),voiceType:e.settings.voiceType,freeVoice:e.settings.freeVoice,premVoice:e.settings.premVoice,plusVoice:e.settings.plusVoice,email:n,speed:e.settings.speed,volume:e.settings.volume,index:reader.currReadIndex,originalText:ttsText.textsForTts[reader.currReadIndex]?ttsText.textsForTts[reader.currReadIndex].original:null,processedText:ttsText.textsForTts[reader.currReadIndex]?ttsText.textsForTts[reader.currReadIndex].processed:null,appVersion:chrome.runtime.getManifest().version};chrome.runtime.sendMessage({fn:"openReportIssues",issue:i},(()=>{chrome.runtime.lastError}))}()},e.saveToMobileBtn.onclick=Ee,e.convertToPdfAgainBtn.onclick=Ee,e.resetBtn.onclick=te,e.relocateBtn.onclick=()=>{"reading"===reader.state&&"undefined"!=typeof nrDomController&&("kindle"===doc.type?nrDomController.highlightLocation(reader.currReadIndex):nrDomController.scrollTo(reader.currReadIndex)),"kindle"!==doc.type&&ae()},Array.from(e.onboard.getElementsByClassName("btn-onboard-close")).forEach((e=>{e.onclick=()=>{reader.stop(),et(!1)}})),Array.from(e.onboard.getElementsByClassName("nr-ext-onboard-skip")).forEach((e=>{e.onclick=()=>{reader.stop(),et(!1)}})),Array.from(e.onboard.getElementsByClassName("nr-ext-onboard-next")).forEach((t=>{t.onclick=()=>{let t=parseInt(e.onboard.getAttribute("onboard-step"));1===t&&reader.stop(),t<3?e.onboard.setAttribute("onboard-step",t+1):et(!1)}})),Array.from(e.msgBox.getElementsByClassName("nr-ext-msg-close")).forEach((e=>{e.onclick=l})),Array.from(e.msgBar.getElementsByClassName("nr-ext-msg-close")).forEach((e=>{e.onclick=l})),e.mobileMsgOffCheckbox.onchange=t=>{e.mobileMsgOffCheckbox.checked&&(e.isShowMobileMessage=!1,O("isShowMobileMessage",!1))},e.msgAndroidButton.onclick=()=>{K("android")},e.msgIosButton.onclick=()=>{K("ios")},e.msgMobileDownload.onclick=()=>{X("msgBar",!1),X("msgBox",!0)},e.msgRateNo.onclick=()=>{l(),chrome.runtime.sendMessage({fn:"openReportIssues"},(()=>{chrome.runtime.lastError}))},e.msgRateYes.onclick=()=>{G(e.msgBox,"msg-type","review")},e.msgLeaveReviewButton.onclick=()=>{window.open("https://chrome.google.com/webstore/detail/natural-reader-text-to-sp/kohfgcgbkjodfcfkcackpagifgbcmimk","_blank"),l()},e.freevoicePopup.onclick=()=>(d(),chrome.runtime.sendMessage({fn:"displayAlertMessage",message:"SHOW_TTS_LIMIT_ALERT",data:{voiceType:e.freevoicePopup.getAttribute("voice-type")}})),t()})).catch((e=>{})),await a(),await async function(){try{if(e.immersiveTextSettingsButton.onclick=()=>{"open"===$(e.immersiveReader).attr("menu-status")?(e.immersiveTextSettingsMenu.style.display="none",e.immersiveReader.setAttribute("menu-status","close")):(e.immersiveTextSettingsMenu.style.display="block",e.immersiveReader.setAttribute("menu-status","open"))},e.immersiveCloseBtn.onclick=()=>{_e()},e.immersiveDyslexiaToggle.onclick=()=>{ce(!e.isDyslexic)},e.immersiveBlurTextToggle.onclick=()=>{le(!e.settings.isImmersiveBlurText)},e.isImmersiveTextSpacing=e.settings.isImmersiveTextSpacing,e.immersiveTextSize=e.settings.immersiveTextSize,Xe(e.isImmersiveTextSpacing),function(t,n=!0){e.immersiveTextSizeSlider.value=t,e.immersiveTextContent.setAttribute("text-scale",t),n&&O("immersiveTextSize",t)}(e.immersiveTextSize,!1),le(e.settings.isImmersiveBlurText),e.immersiveTextSpacingToggle.onclick=()=>{Xe(!e.isImmersiveTextSpacing)},e.immersiveTextContent.setAttribute("text-scale",e.immersiveTextSize),e.immersiveTextSizeSlider.addEventListener("change",(()=>{e.immersiveTextSize=parseFloat(e.immersiveTextSizeSlider.value),e.immersiveTextContent.setAttribute("text-scale",e.immersiveTextSize),O("immersiveTextSize",e.immersiveTextSize)})),"undefined"!=typeof doc&&("googleDoc"===doc.type||"googleDrivePreview"===doc.type)){e.immersivePrevPageButton.style.display="block",e.immersiveNextPageButton.style.display="block",e.immersivePagesToolbar.style.display="flex";const t=doc.getNumPages();e.immersiveTotalPages.innerText=t,e.immersiveCurrentPageInput.value=doc.getPageIndex(),e.immersiveCurrentPageInput.max=t,$(e.immersiveCurrentPageInput,e.shadow).on("keyup",(function(t){if("Enter"===t.key||13===t.keyCode){const t=e.immersiveCurrentPageInput.value;t&&t>=1&&t<=doc.getNumPages()?$e(t-1):e.immersiveCurrentPageInput.value=doc.getPageIndex()+1}})),Ye(),e.immersivePrevPageButton.onclick=Ue((()=>{$e(doc.getPageIndex()-1)})),e.immersiveNextPageButton.onclick=Ue((()=>{$e(doc.getPageIndex()+1)}))}}catch(e){}}(),e.isVoicesInit||await m(),chrome.runtime.sendMessage({fn:"addMostListenedWebsite",origin:location.origin})}catch(e){}}function r(t,n){return new Promise(((i,s)=>{let o;if(!t){let e=n.match(/\.([^.]+)$/);e&&(t=e[1])}t||(t="js");const r="nr-ext-"+n;n=chrome.runtime.getURL(n),"css"===t?(o=document.createElement("link"),o.id=r,o.type="text/css",o.rel="stylesheet",o.href=n,o.onload=()=>{n.includes("nr-ext-reading-bar.css")&&(Se(!0),O("isVisible",!0))},e.shadow.appendChild(o),i()):"js"===t?(o=document.createElement("script"),o.id=r,fetch(n).then((e=>e.text())).then((t=>{o.textContent=t,e.shadow.appendChild(o),i()})).catch((e=>{i()}))):i()})).catch((e=>{}))}function a(t,i,s){return new Promise((t=>{chrome.runtime.sendMessage({fn:"getReadingBarSettings"},(async i=>{if(chrome.runtime.lastError,e.settings=i,e.voiceType=e.settings.voiceType,e.versionNumberLbl.innerText="Version "+chrome.runtime.getManifest().version,e.settings.freeVoice=e.settings.freeVoice?e.settings.freeVoice:voices.defaultFreeVoice,e.settings.premVoice=e.settings.premVoice?e.settings.premVoice:voices.defaultPremVoice,e.settings.plusVoice=e.settings.plusVoice?e.settings.plusVoice:voices.defaultPlusVoice,e.settings&&e.settings.selectedVoice||(e.settings.selectedVoice=voices.defaultPlusVoice),e.settings.preset1Voice=e.settings.preset1Voice?e.settings.preset1Voice:voices.defaultPremVoice,e.settings.preset2Voice=e.settings.preset2Voice?e.settings.preset2Voice:voices.defaultPremVoice,e.settings.preferredVoicesByLang=0===Object.keys(e.settings.preferredVoicesByLang).length?voices.preferredVoicesByLang:e.settings.preferredVoicesByLang,voices.preferredVoicesByLang=e.settings.preferredVoicesByLang,we(e.settings.userInfo,e.settings.loggedIn),e.messageType=e.settings.messageType?e.settings.messageType:"signup",e.messageTime="messageTime"in e.settings?e.settings.messageTime:null,e.messageFirstDay="messageFirstDay"in e.settings?e.settings.messageFirstDay:null,e.rateMessageTime="rateMessageTime"in e.settings?e.settings.rateMessageTime:null,!e.messageFirstDay){const t=Date.now();O("messageFirstDay",t),e.messageFirstDay=t}e.isShowMobileMessage=!("isShowMobileMessage"in e.settings)||e.settings.isShowMobileMessage,e.isShowRateMessage=!("isShowRateMessage"in e.settings)||e.settings.isShowRateMessage,e.isShowSignupMessage=!("isShowSignupMessage"in e.settings)||e.settings.isShowSignupMessage;let s=n.none;e.settings.beHighlighted.length>0&&(s=e.settings.beHighlighted.length>1?n.both:n[e.settings.beHighlighted[0]]),A(e.settings.highlightColour,"light"),E(s.key),"kindle"!==doc.type&&"googleDoc"!==doc.type||me(e.settings.isCC),ve("webpage",e.settings.isQuickStartWebpage),ve("pdf",e.settings.isQuickStartPdf),ve("googleDocs",e.settings.isQuickStartGoogleDocs),ve("email",e.settings.isQuickStartEmail),e.isQuickStartThisWebsite=!(location.origin in e.settings.quickStartBlackList),ve("website",e.isQuickStartThisWebsite),he(),"kindle"===doc.type&&(e.ccToggle.style.display="inline-block",e.immersiveBtn.style.display="none",e.mobileTrigger.style.display="none"),"googleDoc"===doc.type&&(e.ccToggle.style.display="inline-block",e.immersiveBtn.style.display="none"),"googleDrivePreview"===doc.type&&(e.immersiveBtn.style.display="none"),Ve(e.settings.highlightColour),ce(e.settings.isDyslexic),ie(e.settings.isAutoScroll),fe(e.settings.isAutoSelectVoice),se(e.settings.isPlayPauseHotkey),oe(e.settings.isPrevHotkey),re(e.settings.isNextHotkey),ye(e.settings.readIcon),e.isVoicesInit?("pinned"==e.settings.voiceLanguage?(e.languageList.value="pinned",I(e.settings.pinnedVoices,"pinned")):(e.languageList.value=voices.getVoice(e.settings.selectedVoice).languageName,I(voices.allVoicesMap.get(voices.getVoice(e.settings.selectedVoice).languageName))),e.preset1VoiceList.value=e.settings.preset1Voice,e.preset2VoiceList.value=e.settings.preset2Voice):await m(),Re(e.settings.speed,!1),Ne(e.settings.volume,!1),u(e.settings.LimitedReadSelectionCharAmount),"reading"===reader.state?Te():"pause"===reader.state?be():"loading"===reader.state?xe():ke();-1!=navigator.userAgent.indexOf("Mac")||(e.hotkeyActivateText.innerHTML="Ctrl+â‡§+Y",e.playPauseHotkeyText.innerHTML="Alt+P"),e.showOnboard?(et(!0),"gpt"==doc.type&&(e.settings.mode="min"),chrome.runtime.sendMessage({fn:"setShowOnboard",val:!1},(()=>{chrome.runtime.lastError}))):e.onboard&&e.onboard.remove(),t()}))})).then((()=>{e.settings.isVisible&&t&&(t.beingReadTabId&&t.beingReadTabId===t.tabId&&t.activeTabId===t.tabId||!t.beingReadTabId&&t.tabId&&t.activeTabId===t.tabId)?Se(!0):Se(!1)})).catch((e=>{}))}async function c(t){try{e.capsule=document.createElement("DIV"),e.capsule.style.display="none",e.capsule.id="nr-ext-capsule",e.capsule.style.width=0,e.capsule.style.height=0,e.capsule.style.left=0,e.capsule.style.bottom=0,e.capsule.style.display="none",e.shadow=e.capsule.attachShadow({mode:"open"}),await async function(){try{await r(null,"injected/nr-ext-reading-bar/nr-ext-reading-bar.css"),function(){const e=document.createElement("style");e.dataset.description="nr-ext-dyslexic-fonts",e.appendChild(document.createTextNode(i)),document.head.appendChild(e);const t=document.createElement("style");t.dataset.description="nr-ext-poppins-fonts",t.appendChild(document.createTextNode(s)),document.head.appendChild(t)}()}catch(e){}}();const n=document.createElement("DIV");n.innerHTML=t;const o=[],a=document.getElementsByTagName("body")[0];for(;n.children.length>0;)o.push(n.children[0]),e.shadow.appendChild(n.children[0]);a.appendChild(e.capsule)}catch(e){}}function l(e=""){X("msgBar",!1),X("msgBox",!1)}function d(){"undefined"!=typeof nrAlert&&nrAlert.hideAlert(),ae(),l()}function g(t){e.messageTime=Date.now(),t||(t=e.messageType),O("messageType",t),O("messageTime",e.messageTime)}function u(t){e.selectableCharLimit.value=t,O("LimitedReadSelectionCharAmount",t)}function m(){return new Promise((function(t){voices.isSettingVoices||(e.isVoicesInit=!0,function(){e.languageList.innerHTML="";const t=p(Array.from(voices.allVoicesMap.keys()));t.unshift("Pinned Voices");const n=document.createElement("optgroup");n.label="LLM Mult-lingual Voices";const i=document.createElement("optgroup");i.label="A.I. Plus, Premium, Free Voices";for(let s=0;s<t.length;s++){const o=t[s],r=document.createElement("OPTION");r.innerText=o,"Pinned Voices"===o?(r.value="pinned",e.languageList.appendChild(r)):"Multi-Lingual"===o?(r.value="Multi-Lingual",r.innerText="Studio"):r.value=o,"Pinned Voices"!==o&&("Multi-Lingual"===o||"Cloned"===o||"Community"===o?n.appendChild(r):i.appendChild(r))}e.languageList.appendChild(n),e.languageList.appendChild(i),e.languageList.addEventListener("change",(function(){f(e.languageList.value)}))}(),"pinned"==e.settings.voiceLanguage?(e.languageList.value="pinned",I(e.settings.pinnedVoices,"pinned")):(e.languageList.value=voices.getVoice(e.settings.selectedVoice).languageName,I(voices.allVoicesMap.get(voices.getVoice(e.settings.selectedVoice).languageName))),e.voiceSearchInput.addEventListener("input",S),function(){const t=Array.from(Object.values(voices.allVoices));for(let n=0;n<t.length;n++){let i=t[n],s="plus"===i.type?"Plus":"prem"===i.type?"Premium":"Free",o=i.name+" ("+i.languageName+") ("+s+")",r=document.createElement("option");r.value=i.key,r.innerText=o;let a=document.createElement("option");a.value=i.key,a.innerText=o,e.preset1VoiceList.appendChild(r),e.preset2VoiceList.appendChild(a)}e.preset1VoiceList.onchange=t=>{O("preset1Voice",e.preset1VoiceList.value)},e.preset2VoiceList.onchange=t=>{O("preset2Voice",e.preset2VoiceList.value)},e.preset1VoiceList.value=e.settings.preset1Voice,e.preset2VoiceList.value=e.settings.preset2Voice}(),e.showOnboard&&(!function(){e.onboardLanguageList.innerHTML="";const t=p(Object.keys(voices.onboardVoices)),n=document.createElement("optgroup");n.label="LLM Mult-lingual Voices";const i=document.createElement("optgroup");i.label="A.I. Plus, Premium, Free Voices";for(let e=0;e<t.length;e++){const s=t[e],o=document.createElement("OPTION");o.innerText=s,"Multi-Lingual"===s?(o.value="Multi-Lingual",o.innerText="Studio"):o.value=s,"Multi-Lingual"===s?n.appendChild(o):i.appendChild(o)}e.onboardLanguageList.appendChild(n),e.onboardLanguageList.appendChild(i);let s=voices.getLanguageName(navigator.language,!0);if(t.includes(s))e.onboardLanguageList.value=s;else{let n=s.split(" (")[0];for(let i=0;i<t.length;i++)if(t[i].includes(n)){e.onboardLanguageList.value=t[i];break}e.onboardLanguageList.value=t[0]}e.onboardLanguageList.addEventListener("change",(function(){v(voices.onboardVoices[this.value])}))}(),v(voices.onboardVoices[e.onboardLanguageList.value]))),t()})).catch((e=>{}))}function p(e){return!e||e.length<=0?[]:e.sort((function(e,t){if(e.includes("Multi-Lingual")&&!t.includes("Multi-Lingual"))return-1;if(!e.includes("Multi-Lingual")&&t.includes("Multi-Lingual"))return 1;if(e.includes("English")&&!t.includes("English"))return-1;if(!e.includes("English")&&t.includes("English"))return 1;if(e.includes("English")&&t.includes("English")){let n=["US","UK","Australia","India","Wales"],i=e.match(/\(([^)]+)\)/)[1],s=t.match(/\(([^)]+)\)/)[1],o=n.indexOf(i),r=n.indexOf(s);return-1==o&&r>-1||-1==r&&o>-1?1:o<r?-1:o>r?1:0}return e<t?-1:e>t?1:0}))}function v(t){e.onboardVoiceList.innerHTML="";let n=[];for(let i=0;i<t.length;i++){const s=t[i];s.type;let o=voices.getVoiceKey(s.name,s.language,"plus");const r=document.createElement("button");n.push(r),r.classList.add("ext-voice-item"),r.ariaLabel="voice for "+s.languageName+" - "+s.name,r.id=o;const a=document.createElement("div");a.classList.add("voice-icon");const c=document.createElement("img");c.src=M(s),c.alt="voice icon for "+s.languageName+" - "+s.name,a.appendChild(c);const l=document.createElement("div");l.classList.add("voice-name"),l.innerText=s.name,a.appendChild(l),r.appendChild(a);const d=document.createElement("div");d.classList.add("voice-wave"),r.appendChild(d),r.onclick=t=>{const n=r.querySelector(".voice-wave");n.innerHTML;Array.from(r.parentElement.querySelectorAll(".selected-onboard-voice")).forEach((e=>{e.classList.remove("selected-onboard-voice"),e.classList.remove("playing")})),n.innerHTML='<svg> <use xlink:href="#ext_load_wave"></use> </svg>',r.classList.add("playing"),r.classList.add("selected-onboard-voice"),O("plusVoice",o),O("selectedVoice",o),e.languageList.value=voices.getVoice(e.settings.selectedVoice).languageName,I(voices.allVoicesMap.get(voices.getVoice(e.settings.selectedVoice).languageName)),V(e.settings.selectedVoice)&&F(e.voiceListMapper,e.settings.selectedVoice),w(voices.getVoice(o))},e.onboardVoiceList.appendChild(r),0==i&&e.onboardVoiceList.setAttribute("leftmostVoiceIndex",i)}e.onboardVoiceList.setAttribute("leftmostVoiceIndex",0),e.onboardVoiceList.scrollLeft=0,e.onboardVoicePrevBtn.onclick=()=>{let t=parseInt(e.onboardVoiceList.getAttribute("leftmostVoiceIndex"));t>0&&(t-=4,t<0&&(t=0),e.onboardVoiceList.setAttribute("leftmostVoiceIndex",t),n[t].scrollIntoView({inline:"start",behavior:"smooth"}))},e.onboardVoiceNextBtn.onclick=()=>{let t=parseInt(e.onboardVoiceList.getAttribute("leftmostVoiceIndex"));t<n.length+4&&(t+=4,e.onboardVoiceList.setAttribute("leftmostVoiceIndex",t),n[t].scrollIntoView({inline:"start",behavior:"smooth"}))}}function h(){"pinned"!==e.settings.voiceLanguage&&(e.languageList.value=voices.getVoice(e.settings.selectedVoice).languageName,f(e.languageList.value)),F(e.voiceListMapper,e.settings.selectedVoice)}function f(t){"pinned"===t?(I(e.settings.pinnedVoices,"pinned"),O("voiceLanguage","pinned")):(I(voices.allVoicesMap.get(t)),O("voiceLanguage",""))}function y(){!function(t=!1){C(),e.communityVoiceLanguage=voices.clonedSupportedLanguages[0],e.voiceList.innerHTML="",0==Object.keys(voices.communityVoices).length||t?(voices.isLoadingCommunityVoices=!0,x(),voices.getCommunityVoices(t).then((e=>{b(),voices.isLoadingCommunityVoices=!1,T()})).catch((()=>{voices.isLoadingCommunityVoices=!1}))):b()}(!0)}function x(){X("voiceListLoading",!0),X("voiceList",!1)}function T(){X("voiceListLoading",!1),X("voiceList",!0)}function b(t=[]){let n=[];0===t.length?(n=function(){try{let t=voices.clonedSupportedLanguageMapping[e.communityCurLanguage];return Array.from(Object.values(voices.communityVoices)).filter((n=>"All"===e.communityCurLanguage||n.locale===t)).filter((t=>{let n=voices.clonedVoices[t.voiceId+" cloned plus"];return t.isInstalled=!!n,"All"===e.communityFilterGender&&"All"===e.communityFilterTag||("All"===e.communityFilterGender&&"All"!==e.communityFilterTag?!!t.tags&&t.tags.includes(e.communityFilterTag):"All"!==e.communityFilterGender&&"All"===e.communityFilterTag?!!t.gender&&t.gender.toLowerCase()===e.communityFilterGender.toLowerCase():(t.gender&&t.gender.toLowerCase())===e.communityFilterGender.toLowerCase()&&t.tags&&t.tags.includes(e.communityFilterTag))}))}catch(e){}}(),n=function(t){let n=function(){if("Most Used"==e.communityFilterSort)return"trendingCount";if("Most Recent"==e.communityFilterSort)return"createdTimestamp"}();return t.sort(((e,t)=>e[n]>t[n]?-1:e[n]<t[n]?1:0)),t}(n)):n=t,e.voiceList.innerHTML="";for(let t=0;t<n.length;t++)try{let i=n[t];const s=document.createElement("DIV");s.classList.add("nr-ext-voice-cell","nr-ext-community-cell");const o=document.createElement("DIV");o.classList.add("nr-ext-voice-left");let r=document.createElement("BUTTON");r.classList.add("nr-btn-icon"),r.innerHTML='<svg class="nr-icon-24">\n                    <use xlink:href="#ext_community_use"></use>\n                </svg>',o.appendChild(r),r.onclick=()=>{L(i.voiceId)};let a=document.createElement("BUTTON");a.classList.add("nr-btn-icon"),a.innerHTML='<svg class="nr-icon-20">\n                        <use xlink:href="#nr_add_circle"></use>\n                    </svg>',o.appendChild(a),a.onclick=async()=>{await B(i)&&(a.style.display="none",r.style.display="block")},i.isInstalled?(a.style.display="none",r.style.display="block"):(a.style.display="block",r.style.display="none");const c=document.createElement("DIV");c.classList.add("nr-ext-voice-center");const l=document.createElement("DIV");l.classList.add("nr-ext-voice-name"),l.innerText=i.voiceName;const d=document.createElement("DIV");d.classList.add("nr-ext-voice-tags"),d.innerText=voices.clonedCodeToLanguageNameMapping[i.locale]+(i.tags&&i.tags.length>0?", ":"")+(i.tags?i.tags.join(", "):""),c.appendChild(l),c.appendChild(d);const g=document.createElement("BUTTON");g.classList.add("nr-btn-icon","nr-ext-voice-play"),g.innerHTML='<svg class="nr-icon-16"> <use xlink:href="#ext_speaker"></use> </svg>',g.onclick=()=>{P(i)},c.appendChild(g),s.appendChild(o),s.appendChild(c),e.voiceList.appendChild(s)}catch(e){}}function k(t){if(!t)return;e.communityVoiceFilterOptions.innerHTML="",X("communityVoiceFilterButtons",!1),X("communityVoiceFilterOptions",!0);let n=[];switch(t){case"sort":n=["Most Used","Most Recent"];break;case"gender":n=["Male","Female","All"];break;case"tags":n=["All","Young","Adult","Middle Aged","Mature","Calm","Sweet","Confident","Warm","Joyful","Deep","Soft","Casual","Sassy","Excited","Formal","Raspy","Sad","Balanced","Soothing","Professional","Playful","Sophisticated"];break;case"locales":n=["All",...voices.clonedSupportedLanguages]}for(let i=0;i<n.length;i++){const s=document.createElement("OPTION");s.innerText=n[i],s.value=n[i],e.communityVoiceFilterOptions.appendChild(s),s.onclick=()=>{"sort"===t?e.communityFilterSort=s.value:"gender"===t?e.communityFilterGender=s.value:"tags"===t?e.communityFilterTag=s.value:"locales"===t&&(e.communityCurLanguage=s.value),X("communityVoiceFilterMenu",!1),b()}}}function L(t){e.settings.selectedVoice=t+" cloned plus",e.languageList.value="Cloned",I(voices.allVoicesMap.get("Cloned"))}function B(t){return new Promise((n=>{if(!e.settings.loggedIn)return"block"!==e.loginRequiredBar.style.display&&(X("loginRequiredBar",!0),setTimeout((()=>{X("loginRequiredBar",!1)}),5e3)),n(!1);chrome.runtime.sendMessage({fn:"installCommunityVoice",voiceId:t.voiceId},(e=>e?(voices.addNewClonedVoice(t),n(!0)):n(!1)))})).catch((e=>Promise.resolve(!1)))}function C(){e.communityFilterTag="All",e.communityFilterGender="All",e.communityCurLanguage="All",e.communityFilterSort="Most Used"}function I(t,n){if(X("communityVoiceFilter",!1),X("communityVoiceRefresh",!1),e.voiceList.innerHTML="",t[0]&&"Cloned"===t[0].languageName&&voices.isLoadingClonedVoices)return x();let i=[];for(let s=0;s<t.length;s++){let o=t[s];"pinned"===n&&(o=voices.allVoices[o]);const r=o.language+"_"+o.name.replace(/\s+/g,""),a="radio_"+r,c="play_"+r,l=e.settings.pinnedVoices.includes(o.key),d=document.createElement("DIV");d.classList.add("nr-ext-voice-cell"),"Cloned"===o.languageName&&d.classList.add("nr-ext-cloned-cell"),d.setAttribute("ext-pin",l);const g=document.createElement("INPUT");g.classList.add("nr-ext-radio"),g.name="nr-ext-voice",g.type="radio",g.value=r,g.id=a,g.setAttribute("key",o.key),d.appendChild(g);const u=document.createElement("DIV");u.classList.add("nr-ext-voice-left");const m=document.createElement("BUTTON");m.classList.add("nr-btn-icon","nr-ext-voice-pin"),m.innerHTML='<svg class="nr-icon-14 ext-pin"><use xlink:href="#ext_pin_outline"></use></svg><svg class="nr-icon-14 ext-pinned"><use xlink:href="#ext_pinned"></use></svg>',m.style.zIndex=938293580238503e5,u.appendChild(m);let p=null;"Cloned"===o.languageName?(p=document.createElement("DIV"),p.innerText=o.name[0].toUpperCase()):(p=document.createElement("IMG"),p.src=M(o)),p.classList.add("nr-ext-voice-img"),u.appendChild(p),d.appendChild(u);const v=document.createElement("DIV");v.classList.add("nr-ext-voice-center");const h=document.createElement("DIV");h.classList.add("nr-ext-voice-name"),h.innerText=o.name,v.appendChild(h);let f=document.createElement("SPAN");f.style.fontSize="12px",f.style.color="#94D0FF",f.innerText="plus"===o.type?" Plus":"prem"===o.type?" Premium":" Free","plus"===o.type&&("openai"===o.source?f.innerText+=" LLM":f.innerText+=" AI"),v.appendChild(f);const y=document.createElement("BUTTON");y.classList.add("nr-btn-icon","nr-ext-voice-play"),y.ariaLabel="preview for "+r,y.id=c,y.style.zIndex=938293580238503e5,y.innerHTML='<svg class="nr-icon-16"> <use xlink:href="#ext_speaker"></use> </svg>',y.onclick=e=>{e.stopPropagation(),w(o)},v.appendChild(y);const x=document.createElement("DIV");if(x.classList.add("nr-ext-voice-tags"),"Cloned"===o.languageName)x.innerText=voices.clonedCodeToLanguageNameMapping[o.language]+(o.tags&&o.tags.length>0?", ":"")+(o.tags?o.tags.join(", "):"");else{let e="";e=o.displayLocale&&o.localeName?o.languageName.split("(")[0]+" ("+o.localeName+")":o.languageName,e+=(o.tags&&o.tags.length>0?", ":"")+(o.tags?o.tags.join(", "):""),x.innerText=e}v.appendChild(x),d.appendChild(v);const T=document.createElement("DIV");T.classList.add("nr-ext-voice-right");const b=document.createElement("div");b.classList.add("nr-ext-voice-radio"),T.appendChild(b),d.appendChild(T),m.onclick=t=>{if(t.stopPropagation(),e.settings.pinnedVoices.includes(o.key)){if(e.settings.pinnedVoices.splice(e.settings.pinnedVoices.indexOf(o.key),1),d.setAttribute("ext-pin",!1),"pinned"==e.languageList.value){const e=m.closest(".nr-ext-voice-cell");e&&e.remove()}}else e.settings.pinnedVoices.push(o.key),d.setAttribute("ext-pin",!0);O("pinnedVoices",e.settings.pinnedVoices)},"pinned"==e.languageList.value?(e.voiceList.prepend(d),i.unshift(o)):(e.voiceList.appendChild(d),i.push(o)),d.onclick=t=>{const n=t.target;var i;m.contains(n)||y.contains(n)||(i=o.key,F(e.voiceListMapper,i))}}if(function(t,n){const i=e[t];i.options.length=0;for(let e in n){if(t.includes("free")&&n[e].isPrem)continue;const s=document.createElement("option");s.text=n[e].key,s.value=n[e].key,i.add(s)}i.onchange=Ue(D)}("voiceListMapper",i),V(e.settings.selectedVoice))F(e.voiceListMapper,e.settings.selectedVoice);else{if(e.settings.selectedVoice&&e.settings.selectedVoice.includes("cloned"))return;N(e.settings.selectedVoice)}}function S(t){if("Community"==e.languageList.value){b(Array.from(Object.values(voices.communityVoices)).filter((t=>t.voiceName.toLowerCase().includes(e.voiceSearchInput.value.toLowerCase()))))}else{I(Object.values(voices.allVoices).filter((t=>t.name.toLowerCase().includes(e.voiceSearchInput.value.toLowerCase()))))}}function V(t){let n=Array.from(e.voiceListMapper.getElementsByTagName("option"));for(let e=0;e<n.length;e++)if(n[e].value===t)return!0;return!1}function M(e){if("plus"===e.type){const t="https://wwwnaturalreaderscom.s3.amazonaws.com/pw-portraits/",n=voices.getLanguageName(e.language,!1,!1).toLocaleLowerCase(),i=e.name.normalize("NFD").replace(/[\u0300-\u036f]/g,"");return t+n+"/"+("english"===n?i+".jpg":i.split(" (")[0]+".jpg")}return"prem"===e.type?chrome.runtime.getURL("/assets/img/prem.svg"):chrome.runtime.getURL("/assets/img/free.svg")}function w(e){reader.preview(e)}function P(e){return e.language=e.locale,e.type="plus",e.id=e.voiceId,e.source="ms-cloned",e.isExpired=e.isExpired,e.key=e.voiceId+" cloned plus",reader.preview(e)}function E(t){e.highlightTypeMenu.value=t,O("beHighlighted",n[t].value);const i=e.highlightColourMenu.value;R(i,i)}function A(t,n){e.highlightColourMenu.value=t,R(t,n),O("highlightColour",t)}function R(t,n){const i=e.highlightTypeMenu.value;let s="nr-sentence-highlight-"+t,o="nr-word-highlight-"+t;switch(function(t){let n="nr-sentence-highlight-"+t,i="nr-word-highlight-"+t;Array.from(e.highlightPreview.getElementsByClassName("nr-ext-sentence")).forEach((e=>{e.classList.remove(n)})),Array.from(e.highlightPreview.getElementsByClassName("nr-ext-word")).forEach((e=>{e.classList.remove(i)}))}(n),i){case"both":Array.from(e.highlightPreview.getElementsByClassName("nr-ext-sentence")).forEach((e=>{e.classList.add(s)})),Array.from(e.highlightPreview.getElementsByClassName("nr-ext-word")).forEach((e=>{e.classList.add(o)}));break;case"sentence":Array.from(e.highlightPreview.getElementsByClassName("nr-ext-sentence")).forEach((e=>{e.classList.add(s)}));break;case"word":Array.from(e.highlightPreview.getElementsByClassName("nr-ext-word")).forEach((e=>{e.classList.add(o)}))}}function D(t){let n="";n=t.target.value.includes("plus")?"plus":t.target.value.includes("prem")?"prem":"free",n&&(O("voiceType",n),N(t.target.value),O(n+"Voice",t.target.value),O("selectedVoice",t.target.value));!function(e){try{e&&!e.checked&&(e.checked=!0)}catch(e){}}(e.voiceList.querySelectorAll(".nr-ext-radio")[t.target.selectedIndex])}function N(t){if(e.voiceIconCloned.style.display="none",!t)return;let n=t.includes("("),i=t.split(" "),s=n?i[0]+" "+i[1]:i[0],o=i.slice(-2)[0],r=i[i.length-1];if("cloned"===o){e.voiceIconCloned.style.display="block",e.voiceIcon.style.display="none",voices.getVoice(t)&&(e.voiceIconCloned.innerHTML=voices.getVoice(t).name[0])}else e.voiceIcon.style.display="block",e.voiceIcon.src=M({name:s,language:o,type:r}),"plus"!=r?e.voiceIcon.classList.add("icon-svg"):e.voiceIcon.classList.contains("icon-svg")&&e.voiceIcon.classList.remove("icon-svg")}function F(e,t){let n=e;const i=new Event("change");n&&null!==t&&(n.value=t),n&&n.dispatchEvent(i)}function O(t,n,i=null){"voiceType"===t&&n!==e.settings.voiceType?(reader.setTts(n),i&&i.sameLang&&(e.settings.selectedVoice.includes("multi")||e.settings.selectedVoice.includes("cloned")?(e.settings.voiceType=n,e.settings.selectedVoice=e.settings[n+"Voice"],e.updateVoice()):voices.autoSelectVoice(e.settings[e.settings.voiceType+"Voice"].split(" ").slice(-2)[0],n)),reader.replay()):"freeVoice"==t||"premVoice"==t||"plusVoice"==t?(i&&!i.isAutoSelected&&voices.rememberPreferredVoiceByLang(t.split("Voice")[0],n),"default"===n&&(n=voices[n+(t.charAt(0).toUpperCase()+t.slice(1))]),n!==e.settings[t]&&(reader.setTts(e.settings.voiceType),reader.replay())):("speed"===t&&n!==e.settings.speed||"volume"===t&&n!==e.settings.volume)&&reader.replay(),e.settings[t]=n,i&&i.toPlay&&reader.play(),chrome.runtime.sendMessage({fn:"setReadingBarSetting",key:t,value:n},(()=>{chrome.runtime.lastError}))}function H(){chrome.runtime.sendMessage({fn:"logout"},(()=>{chrome.runtime.lastError}))}function q(){chrome.runtime.sendMessage({fn:"login"},(()=>{chrome.runtime.lastError}))}function U(){chrome.runtime.sendMessage({fn:"signup"},(()=>{chrome.runtime.lastError}))}function j(){const t=e.controls.querySelector(".nr-ext-max");t.classList.contains("show-sub")?t.classList.remove("show-sub"):t.classList.add("show-sub")}function Q(){document.body.style.pointerEvents="none"}function _(){document.body.style.pointerEvents="unset"}function W(e,t,n){const i=window.innerHeight,s=window.innerWidth;let o=e.getBoundingClientRect(),r=o.right-o.left,a=o.bottom-o.top;e.style.right=t>=0&&t+r<=s?s-(t+r)+"px":t<0?s-r+"px":"0px",e.style.top=n>=0&&n+a<=i?n+"px":n<0?"0px":i-a+"px"}function G(e,t,n){$(e).attr(t,n)}function z(t){const n=e.container.getAttribute("menu-status");"settings"==t?"settings"==n?e.container.setAttribute("menu-status","init"):e.container.setAttribute("menu-status","settings"):e.container.setAttribute("menu-status","init")}function Y(t){e.container.getAttribute("menu-status")==t||"init"==t?e.container.setAttribute("menu-status","init"):e.container.setAttribute("menu-status",t)}function X(t,n=!0){e[t]&&(e[t].style.display=n?"block":"none")}function J(){try{if("pause"===reader.state||"init"===reader.state)if(nrDomDetector.hasSelectionOnPage(!1))ne();else if(!doc||"googleDoc"!==doc.type&&"googleDrivePreview"!==doc.type)if(doc&&"kindle"===doc.type){doc.isSameText()||reader.stop(),reader.play({caller:"readBtn"})}else reader.play({caller:"readBtn"});else if("googleDoc"===doc.type){let e=null;Be();const t=setInterval((function(){if(!doc.isRendering){Le(),clearInterval(t),e&&clearTimeout(e);const n=doc.getPageIndex(),i=doc.getCurrentIndex();n!==i?reader.readPage(i,0):reader.play({caller:"readBtn"})}}),100);e=setTimeout((()=>{clearInterval(t),Le()}),6e4)}else{const e=doc.getPageIndex(),t=doc.getCurrentIndex();e!==t?reader.readPage(t):reader.play({caller:"readBtn"})}else reader.pause(!0),function(){d(),z("init");const t=null!=e.messageTime?utils.getDiffInDay(e.messageTime):null,n=null!=e.messageFirstDay?utils.getDiffInDay(e.messageFirstDay):null;(null==t||t>=1)&&(null==e.rateMessageTime&&n>=2||null!=e.rateMessageTime&&utils.getDiffInDay(e.rateMessageTime)>=60?(X("msgBar",!1),X("msgBox",!0),G(e.msgBox,"msg-type","rate"),e.messageTime=Date.now(),O("messageTime",e.messageTime),O("rateMessageTime",e.messageTime)):"mobile"!==e.messageType&&e.isShowMobileMessage?(e.messageType="mobile",G(e.msgBar,"msg-type","mobile"),G(e.msgBox,"msg-type","mobile"),O("isShowMobileMessage",!1),e.isShowMobileMessage=!1,X("msgBar",!0),X("msgBox",!1),g()):!e.settings.loggedIn&&e.isShowSignupMessage&&(e.messageType="signup",X("msgBar",!0),G(e.msgBar,"msg-type","signup"),O("isShowSignupMessage",!1),e.isShowSignupMessage=!1,g()))}()}catch(e){}}function K(e){let t="";t="ios"===e?"https://apps.apple.com/app/id1487572960":"https://play.google.com/store/apps/details?id=com.naturalsoft.personalweb",window.open(t,"_blank")}function Z(){window.open("https://www.naturalreaders.com/online/?action=pe&source=ext-pe","_blank")}function ee(){window.open("https://www.naturalreaders.com/online/?action=billing&source=ext-billing","_blank")}function te(){chrome.runtime.sendMessage({fn:"reload"},(()=>{chrome.runtime.lastError}))}function ne(){chrome.runtime.sendMessage({fn:"readSelection"},(()=>{chrome.runtime.lastError})),nrDomDetector.frame.style.display="none"}function ie(t,n=!1){e.isAutoScroll=t,ue(e.isAutoScroll,e.autoScrollToggle),O("isAutoScroll",t),n&&chrome.runtime.sendMessage({fn:"relocate"},(()=>{chrome.runtime.lastError}))}function se(t){e.isPlayPauseHotkey=t,ue(e.isPlayPauseHotkey,e.playPauseHotkeyToggle),O("isPlayPauseHotkey",t)}function oe(t){e.isPrevHotkey=t,ue(e.isPrevHotkey,e.prevHotkeyToggle),O("isPrevHotkey",t)}function re(t){e.isNextHotkey=t,ue(e.isNextHotkey,e.nextHotkeyToggle),O("isNextHotkey",t)}function ae(){e.relocateBtn&&(e.relocateBtn.style.display="none")}function ce(t){e.isDyslexic=t,ue(e.isDyslexic,e.immersiveDyslexiaToggle),O("isDyslexic",e.isDyslexic),function(t){t?(e.ccText.classList.add("dyslexicfonts"),e.immersiveTextContainer.classList.add("dyslexicfonts")):e.immersiveTextContainer.classList.remove("dyslexicfonts")}(t)}function le(t){ue(t,e.immersiveBlurTextToggle),O("isImmersiveBlurText",t),de(t)}function de(t){const n=e.immersiveReader.getElementsByTagName("nr-sentence");for(let e=0;e<n.length;e++)t?(n[e].classList.remove("nr-not-read"),n[e].classList.add("nr-not-read-blur")):(n[e].classList.remove("nr-not-read-blur"),n[e].classList.add("nr-not-read"))}function ge(t,n=!1){return new Promise((i=>{if(e.isClickToRead=t,O("isClickToRead",e.isClickToRead),e.isClickToRead)if(reader.isFirstRead&&"all"===reader.readOption)if(e.readBtn.classList.add("nr-ext-spin"),e.readBtn.style.pointerEvents="none",e.forwardBtn.style.pointerEvents="none",e.backwardBtn.style.pointerEvents="none",n)e.readBtn.classList.remove("nr-ext-spin"),e.readBtn.style.pointerEvents="auto",e.forwardBtn.style.pointerEvents="auto",e.backwardBtn.style.pointerEvents="auto",i();else{let t="all";nrDomDetector.hasSelectionOnPage(!1)&&(t="selection"),reader.setTextsForTtsWithoutPlay(t),e.readBtn.classList.remove("nr-ext-spin"),e.readBtn.style.pointerEvents="auto",e.forwardBtn.style.pointerEvents="auto",e.backwardBtn.style.pointerEvents="auto",i()}else i();else i();ue(e.isClickToRead,e.clickToReadToggle)})).catch((e=>{}))}function ue(e,t){t.checked=!!e}function me(t){e.isCC=t,ue(e.isCC,e.ccToggle),e.isCC?(O("isCC",!0),"reading"===reader.state?pe(!0):pe(!1),e.ccToggle.classList.add("on")):(O("isCC",!1),pe(!1),e.ccToggle.classList.remove("on"))}function pe(t){t?(e.ccContainer.style.display="block",e.isCCVisible=!0):(e.ccContainer.style.display="none",e.isCCVisible=!1)}function ve(t,n=null,i=!1){"webpage"===t?(O("isQuickStartWebpage",n),e.isQuickStartWebpage=n,e.quickStartWebpageCheckbox.checked=e.isQuickStartWebpage):"pdf"===t?(O("isQuickStartPdf",n),e.isQuickStartPdf=n,e.quickStartPdfCheckbox.checked=e.isQuickStartPdf):"email"===t?(O("isQuickStartEmail",n),e.isQuickStartEmail=n,e.quickStartEmailCheckbox.checked=e.isQuickStartEmail,e.isQuickStartEmail||("undefined"!=typeof outlookUiIcons&&outlookUiIcons.removeIcons(),"undefined"!=typeof gmailIcons&&gmailIcons.removeIcons())):"googleDocs"===t?(O("isQuickStartGoogleDocs",n),e.isQuickStartGoogleDocs=n,e.quickStartGoogleDocsCheckbox.checked=e.isQuickStartGoogleDocs):"website"===t&&(e.isQuickStartThisWebsite=n,e.isQuickStartThisWebsite?chrome.runtime.sendMessage({fn:"removeQuickStartBlackList"},(()=>{chrome.runtime.lastError})):chrome.runtime.sendMessage({fn:"addQuickStartBlackList"},(()=>{chrome.runtime.lastError})),e.quickStartWebsiteCheckbox.checked=e.isQuickStartThisWebsite),i&&he()}function he(){e.isQuickStartWebpage||e.isQuickStartPdf||e.isQuickStartGoogleDocs||e.isQuickStartEmail||e.isQuickStartThisWebsite?ue(!0,e.quickStartToggle):ue(!1,e.quickStartToggle)}function fe(t){e.isAutoSelectVoice=t,ue(e.isAutoSelectVoice,e.autoSelectVoiceToggle),O("isAutoSelectVoice",t)}function ye(t){e.isReadIcon=t,ue(e.isReadIcon,e.readIcon),O("readIcon",e.isReadIcon),null!=nrDomDetector&&nrDomDetector.switchIcon(t)}function xe(){if(e.container.setAttribute("play-state","play"),e.readBtn.classList.add("nr-ext-spin"),e.forwardBtn.disabled=!0,e.backwardBtn.disabled=!0,"gpt"===doc.type&&doc.readBtnId){let e=document.getElementById(doc.readBtnId);e&&(e.classList.add("nr-ext-spin"),e.classList.add("nr-ext-pause"),e.classList.remove("nr-ext-play"),e.setAttribute("nr-ext-reader-state","reading"))}}function Te(){if(e.readBtn&&e.readBtn.classList.contains("nr-ext-spin")&&e.readBtn.classList.remove("nr-ext-spin"),e.container.setAttribute("play-state","play"),e.forwardBtn.disabled=!1,e.backwardBtn.disabled=!1,"kindle"!==doc.type&&"googleDoc"!==doc.type||(e.ccToggle.style.display="inline-block"),"googleDoc"===doc.type&&doc.changeDisplayPageOverlays(!0),"gpt"===doc.type&&doc.readBtnId){let e=document.getElementById(doc.readBtnId);e&&(e.classList.contains("nr-ext-spin")&&e.classList.remove("nr-ext-spin"),e.classList.add("nr-ext-pause"),e.classList.remove("nr-ext-play"),e.setAttribute("nr-ext-reader-state","reading"))}"undefined"!=typeof nrTitleBar&&nrTitleBar&&nrTitleBar.shadow&&nrTitleBar.shadow.getElementById("nr-ext-title-bar").setAttribute("data-play","play")}function be(){if(e.readBtn&&e.readBtn.classList.contains("nr-ext-spin")&&e.readBtn.classList.remove("nr-ext-spin"),"init"!==reader.state&&e.container.setAttribute("play-state","pause"),e.forwardBtn.disabled=!1,e.backwardBtn.disabled=!1,e.ccToggle.style.display="none",ae(),"googleDoc"===doc.type&&doc.changeDisplayPageOverlays(!1),"gpt"===doc.type&&doc.readBtnId){let e=document.getElementById(doc.readBtnId);e&&(e.classList.remove("nr-ext-pause"),e.classList.add("nr-ext-play"),e.setAttribute("nr-ext-reader-state","pause"),e.classList.contains("nr-ext-spin")&&e.classList.remove("nr-ext-spin"))}"undefined"!=typeof nrTitleBar&&nrTitleBar&&nrTitleBar.shadow&&nrTitleBar.shadow.getElementById("nr-ext-title-bar").setAttribute("data-play","pause")}function ke(){if(e.readBtn&&e.readBtn.classList.contains("nr-ext-spin")&&e.readBtn.classList.remove("nr-ext-spin"),e.container.setAttribute("play-state","init"),reader.state="init",e.ccToggle.style.display="none",pe(!1),ae(),"googleDoc"===doc.type&&doc.changeDisplayPageOverlays(!1),"gpt"===doc.type&&doc.readBtnId){let e=document.getElementById(doc.readBtnId);e&&(e.classList.remove("nr-ext-pause"),e.classList.add("nr-ext-play"),e.setAttribute("nr-ext-reader-state","pause"),e.classList.contains("nr-ext-spin")&&e.classList.remove("nr-ext-spin"))}"kindle"===doc.type&&doc.hideHighlightCanvas(),"undefined"!=typeof nrTitleBar&&nrTitleBar&&nrTitleBar.shadow&&nrTitleBar.shadow.getElementById("nr-ext-title-bar").setAttribute("data-play","pause")}function Le(){be(),clearInterval(e.progressTimeIncrementor),e.progressTimeIncrementor=null}function Be(){xe()}function Ce(t,n,i){if(doc&&"googleDoc"===doc.type&&!doc.hasAnnotated)return chrome.runtime.sendMessage({fn:"displayAlertMessage",message:"ERR_DOCS_NO_ANNOTATED"}),i(!1);t.tabId&&(nrDomController.beingReadTabId=t.tabId),t.activeTabId&&(nrDomController.activeTabId=t.activeTabId);let s=!1;if(!e.isInjectingReadingBar&&!e.hasReadingBar){if("undefined"!=typeof nrQuickStart){nrQuickStart.isExpanded&&(s=!0),nrQuickStart=null;const e=document.getElementById("nr-ext-quick-start-capsule");e&&e.remove()}e.isInjectingReadingBar=!0,e.showOnboard=!!t.showOnboard&&t.showOnboard,chrome.runtime.sendMessage({fn:"setIcon",state:"loading"},(()=>{chrome.runtime.lastError})),e.loadingTimer||(e.loadingTimer=setTimeout((()=>{clearTimeout(e.loadingTimer),chrome.runtime.sendMessage({fn:"setIcon"},(()=>{chrome.runtime.lastError}))}),1e4)),fetch(chrome.runtime.getURL("injected/nr-ext-reading-bar/nr-ext-reading-bar.html")).then((e=>e.text())).then((e=>new Promise((async t=>{await c(e),t()})))).then((async()=>{let n=!1;t.isEmail&&(n=t.isEmail),await async function(t=!1){await o(),e.hasReadingBar=!0,chrome.runtime.sendMessage({fn:"setIcon"},(()=>{chrome.runtime.lastError})),clearTimeout(e.loadingTimer),e.isInjectingReadingBar=!1,ue(e.isClickToRead,e.clickToReadToggle)}(n),e.inactivityTimeout=setTimeout((()=>{reader.setIsSpeechMark(!1)}),2e4),document.addEventListener("mousedown",utils.debounce(tt,1e3)),document.addEventListener("wheel",utils.debounce(tt,1e3)),document.addEventListener("keydown",utils.debounce(tt,1e3)),document.addEventListener("touchstart",utils.debounce(tt,1e3)),document.addEventListener("touchmove",utils.debounce(tt,1e3)),document.addEventListener("visibilitychange",(e=>{"visible"!==document.visibilityState&&reader.setIsSpeechMark(!1)})),window.addEventListener("keyup",(function(t){"ArrowUp"==t.key?e.isPrevHotkey&&reader.backward():"ArrowDown"==t.key&&e.isNextHotkey&&reader.forward()})),s&&j(),i(!0)})).catch((e=>{}))}}function Ie(t,n,i){t&&t.toShow||"none"===e.ext.style.display?(Se(!0),O("isVisible",!0),a(t),reader.isFirstRead&&("undefined"!=typeof nrTextProcessor&&nrTextProcessor.resetDocInnerTexts(),ge(e.isClickToRead))):(Se(!1),O("isVisible",!1)),t.beingReadTabId&&(nrDomController.beingReadTabId=t.beingReadTabId),t.activeTabId&&(nrDomController.activeTabId=t.activeTabId)}function Se(t){t?(e.ext.style.display="block",e.capsule.style.display="block"):(_e(!1),pe(!1),"undefined"!=typeof nrAlert&&nrAlert&&nrAlert.hideAlert(),e.ext.style.display="none")}function Ve(t,n=null){e.ccContainer&&(n&&e.ccContainer.classList.remove("nr-sentence-highlight-"+n),e.ccContainer.classList.add("nr-sentence-highlight-"+t))}function Me(t){t||(e.userEmail.innerText=""),t.email&&t.email!=e.defaultEmail?e.userEmail.innerText=t.email:e.userEmail.innerText=""}function we(t,n){n?(e.loginUI.style.display="none",e.emailUI.style.display="block",e.saveToMobileBtn.style.display="block",e.mobileLoginBtn.style.display="none",e.logoutBtn.style.display="inline-block",e.peBtn&&(e.peBtn.disabled=!1),e.onboard&&"none"!==e.onboard.style.display&&et(!1),Me(t)):(e.loginUI.style.display="block",e.emailUI.style.display="none",e.logoutBtn.style.display="none",e.saveToMobileBtn.style.display="none",e.mobileLoginBtn.style.display="block",e.peBtn&&(e.peBtn.disabled=!0),Me(t))}function Pe(t="init"){switch(t){case"init":default:e.saveToMobileErrorMsg.style.display="none",e.saveToMobileFinish.style.display="none",e.saveToMobileSaving.style.display="none",e.saveToMobileInit.style.display="block";break;case"saving":e.saveToMobileErrorMsg.style.display="none",e.saveToMobileFinish.style.display="none",e.saveToMobileSaving.style.display="block",e.saveToMobileInit.style.display="none";break;case"finish":e.saveToMobileErrorMsg.style.display="none",e.saveToMobileFinish.style.display="block",e.saveToMobileSaving.style.display="none",e.saveToMobileInit.style.display="none";break;case"error":e.saveToMobileErrorMsg.style.display="block",e.saveToMobileFinish.style.display="none",e.saveToMobileSaving.style.display="none",e.saveToMobileInit.style.display="none"}}function Ee(){return"googleDoc"===doc.type||"gpt"===doc.type?function(){if(e.isSavingToMobile)return;e.isSavingToMobile=!0;const t=e.settings.userInfo?e.settings.userInfo.id:"";Pe("saving"),doc.parseForConvertToPdf().then((function(n){fetch(chrome.runtime.getURL("assets/template.html")).then((e=>e.text())).then((i=>{let s="";if("gpt"===doc.type&&n.length>0)try{s=Array.from(n[0].closest("div.group").previousSibling.getElementsByClassName("empty:hidden"))[0].innerText}catch(e){}else{let e=document.head.getElementsByTagName("title");e.length>0&&(s=e[0].innerText)}var o=Ae("Description");""==o&&(o=Ae("description"));let r=[];for(var a=0;a!=n.length;a++)if(""!=s)r.push(n[a].innerText);else{const e=n[a].nodeName.toLowerCase();"h1"!=e&&"h2"!=e||(s=n[a].innerText)}for(i+=s+"</div>",i+='<div class="pdf-subtitle">'+o+"</div>",i+='<section class="pdf-content">',a=0;a!=r.length;a++)i+='<p class="pdf-paragraphs">'+r[a]+"</p>";i+="</section></body></html>";const c=new XMLHttpRequest,l=new URLSearchParams;l.set("html",i),l.set("title",s),t&&l.set("userid",t),c.open("POST","https://uploadocr.naturalreaders.com/html2pdf"),c.onreadystatechange=function(){this.readyState===XMLHttpRequest.DONE&&this.status>=400&&(Pe("error"),e.saveToMobileErrorMsg.innerText="Server error"),this.readyState===XMLHttpRequest.DONE&&200===this.status&&Pe("finish"),e.isSavingToMobile=!1},c.onerror=function(t){Pe("error"),e.saveToMobileErrorMsg.innerText="Server error",e.isSavingToMobile=!1};try{c.send(l)}catch(t){Pe("error"),e.saveToMobileErrorMsg.innerText="Server or unknown error",e.isSavingToMobile=!1}})).catch((t=>{Pe("error"),e.saveToMobileErrorMsg.innerText="Unknown error",e.isSavingToMobile=!1}))})).catch((t=>{Pe("error"),e.saveToMobileErrorMsg.innerText="Error getting texts from the page",e.isSavingToMobile=!1}))}():function(){if(e.isSavingToMobile)return;let t=location.href;e.isSavingToMobile=!0;let n="NaturalReader_PDF";const i=e.settings.userInfo?e.settings.userInfo.id:"";let s="";Pe("saving");const o="https://readability.naturalreaders.com/";let r={url:t,service:"urltojson"};e.settings.userInfo&&e.settings.userInfo.email&&(s=e.settings.userInfo.email,r.userEmail=s);const a={"Content-Type":"application/json"};return fetch(o+"urltojson",{method:"POST",mode:"cors",cache:"no-cache",headers:a,referrer:"client",referrerPolicy:"origin-when-cross-origin",body:JSON.stringify(r)}).then((e=>e.json())).then((e=>(n=e.title,r={htmlContent:e.content,service:"jsontopdf",url:t,title:n},i&&(r.userId=i),s&&(r.userEmail=s),fetch(o+"jsontopdf",{method:"POST",mode:"cors",cache:"no-cache",headers:a,referrer:"client",referrerPolicy:"origin-when-cross-origin",body:JSON.stringify(r)})))).then((e=>e.json())).then((t=>{Pe("finish"),e.isSavingToMobile=!1})).catch((t=>{Pe("error"),e.saveToMobileErrorMsg.innerText="Error saving page",e.isSavingToMobile=!1}))}()}function Ae(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n].getAttribute("content");return""}function Re(t,n=!0){e.speedSlider.value=t,De(t),n&&O("speed",t)}function De(t){e.speedText.innerHTML=t+" wpm";let n=function(e){let t=Math.round(e/180*100)/100;"00"==t.toString().split(".")[1]&&(t=Math.round(t));return t}(t);e.speedFactorText.innerHTML=n,e.speedTriggerText.innerHTML=n}function Ne(t,n=!0){e.volumeSlider.value=t,Fe(t),n&&O("volume",t)}function Fe(t){e.volumeText.innerText=Math.round(100*t)+"%"}function Oe(t=null){try{if(!t)return;let n=0;t.map(((t,i)=>{if(0===i)e.indexToProgressTime[i]={displayedTime:"0:00",seconds:0};else{const t=Math.round(n/He(e.settings.speed));e.indexToProgressTime[i]={displayedTime:qe(t),seconds:t}}n+=t.processed.length}));const i=Math.round(n/He(e.settings.speed));e.indexToProgressTime[t.length]={displayedTime:qe(i),seconds:i}}catch(e){}}function He(e){return isNaN(e)&&(e=parseInt(e)),e/180*5}function qe(e){const t=parseInt(e,10);let n=Math.floor(t/3600),i=Math.floor((t-3600*n)/60),s=t-3600*n-60*i;return n>=1&&n<10&&(n="0"+n),i<10&&(i="0"+i),s<10&&(s="0"+s),n<1?i+":"+s:n+":"+i+":"+s}function Ue(e,t=500,n=!0){var i;return function(){var s=this,o=arguments,r=function(){i=null,n||e.apply(s,o)},a=n&&!i;clearTimeout(i),i=setTimeout(r,t),a&&e.apply(s,o)}}function je(t,n){$(e.ccText).empty();let i=document.createTextNode(t);e.ccText.appendChild(i)}e.communityVoiceLanguage=null,e.communityFilterTag="All",e.communityFilterGender="All",e.communityCurLanguage="All",e.communityFilterSort="Most Used",chrome.runtime.onMessage.addListener((function(t,n,i){if(t.fn in readingBar){if(readingBar[t.fn](t,n,i),readingBar.isAsyncFunction(t.fn))return!0}else{if("injectReadingBar"===t.message)return Ce(t,0,i),!0;"textsToReadOnChange"===t.message?Oe(t.texts):"tabOnActivated"===t.message?a(t):"setLoggedInUI"===t.fn||"setLoggedOutUI"===t.fn?chrome.runtime.sendMessage({fn:"getReadingBarSettings"},(async t=>{chrome.runtime.lastError,e.settings=t,e.settings.userInfo&&we(e.settings.userInfo,e.settings.loggedIn)})):"readSelectionOnEnd"===t.message||("toggleShowReadIcon"===t.message?ye(t.value):"highlightColourOnChange"===t.message?Ve(t.highlightColour,t.oldHighlightColour):"setReadingBarSetting"===t.message&&O(t.key,t.value,t.data))}}));const Qe=window.matchMedia("(prefers-color-scheme: dark)");Qe.matches?e.systemTheme="dark":e.systemTheme="light";try{Qe.addEventListener("change",(e=>{systemThemeOnChange(e)}))}catch(e){try{Qe.addListener((e=>{systemThemeOnChange(e)}))}catch(e){}}function _e(t=null){null===t?(e.isImmersive=!e.isImmersive,e.isImmersive?We():Ge()):(e.isImmersive=t,t?We():Ge())}function We(){e.immersiveBtn.classList.add("on"),"undefined"!=typeof nrTextProcessor&&(!reader.isFirstRead&&nrTextProcessor.isSameText()?(e.immersiveReader.style.display="block",e.ext.setAttribute("immersive",!0)):(Je(),reader.setTextsForTtsWithoutPlay(),e.immersiveReader.style.display="block",e.ext.setAttribute("immersive",!0)))}function Ge(){e.immersiveBtn.classList.remove("on"),e.ext.setAttribute("immersive",!1),"googleDoc"!==doc.type&&(document.body.style.overflowY="auto"),ze(),e.immersiveReader.style.display="none"}function ze(){e.immersiveTextSettingsMenu.style.display="none",e.immersiveReader.setAttribute("menu-status","close")}function $e(e){if("reading"===reader.state)reader.readPage(e);else if(doc.scrollToPage)return doc.scrollToPage(e).then((e=>{reader.setTextsForTtsWithoutPlay()}))}async function Ye(){if(void 0===doc.getPageIndex)return;const t=doc.getPageIndex();e.immersiveCurrentPageInput.value=t+1,e.immersivePrevPageButton.disabled=0===t;const n=doc.getNumPages();e.immersiveNextPageButton.disabled=t>=n-1||-1==t}function Xe(t){e.isImmersiveTextSpacing=t,e.isImmersiveTextSpacing?(e.immersiveTextSpacingToggle.setAttribute("toggle-status","on"),e.immersiveTextContainer.classList.add("nr-text-spacing")):(e.immersiveTextSpacingToggle.setAttribute("toggle-status","off"),e.immersiveTextContainer.classList.remove("nr-text-spacing")),O("isImmersiveTextSpacing",e.isImmersiveTextSpacing)}function Je(){e.immersiveTextContainer.innerHTML=""}function Ke(t){return new Promise((n=>{for(let n=0;n<t.length;n++){const i=t[n];let s=null;"h1"===i.tagName.toLowerCase()?(s=document.createElement("H1"),s.classList.add("nr-immersive-heading1")):"h2"===i.tagName.toLowerCase()?(s=document.createElement("H2"),s.classList.add("nr-immersive-heading2")):s=document.createElement("P");const o=Array.from(i.querySelectorAll("nr-sentence"));let r=-1;for(let t=0;t<o.length;t++){const n=o[t].classList;let i=-1;for(let e=0;e<n.length;e++)if(n[e].includes("nr-s")){i=parseInt(o[t].id.split("nr-s")[1]);break}if(r!=i){const n=nrTextProcessor.textsToRead[i],a=o[t].cloneNode(!0);a.innerHTML="";const c=document.createTextNode(n);utils.isRtlText(n)&&s.classList.add("nr-rtl"),a.appendChild(c),a.removeAttribute("class"),sentenceId="nr-immersive-s"+i,a.classList.add(sentenceId),a.id=sentenceId,nrDomController.bindClickToReadEventsForImmersiveReader(a),s.appendChild(a),s.appendChild(document.createTextNode(" ")),e.immersiveTextContainer.appendChild(s),r=i}}}n()})).catch((e=>{}))}function Ze(){e.isDyslexic&&e.immersiveTextContainer.classList.add("dyslexicfonts")}async function et(t){t?e.onboard.style.display="flex":("prem"===e.settings.voiceType?O("plusVoice","default"):"plus"===e.settings.voiceType&&O("premVoice","default"),e.onboard.remove())}function tt(){"undefined"!=typeof nrDomController&&nrDomController.activeTabId&&nrDomController.activeTabId===nrDomController.beingReadTabId&&(e.inactivityTimeout&&(reader.setIsSpeechMark(!0),clearTimeout(e.inactivityTimeout),e.inactivityTimeout=null),e.inactivityTimeout||(e.inactivityTimeout=setTimeout((()=>{reader.setIsSpeechMark(!1)}),2e4)))}}var readingBar=readingBar||new NRExtReadingBar;